{"version":3,"sources":["file:///Volumes/%E5%9B%BA%E6%80%81/ccProject/node_modules/crypto-es/lib/mode-cfb.js"],"names":["CFB","generateKeystreamAndEncrypt","words","offset","blockSize","cipher","_words","keystream","iv","_iv","slice","undefined","_prevBlock","encryptBlock","i","BlockCipherMode","Encryptor","processBlock","_cipher","call","Decryptor","thisBlock"],"mappings":";;;uBA+BaA,G;;AA3Bb,WAASC,2BAAT,CAAqCC,KAArC,EAA4CC,MAA5C,EAAoDC,SAApD,EAA+DC,MAA/D,EAAuE;AACrE,UAAMC,MAAM,GAAGJ,KAAf;AACA,QAAIK,SAAJ,CAFqE,CAIrE;;AACA,UAAMC,EAAE,GAAG,KAAKC,GAAhB,CALqE,CAOrE;;AACA,QAAID,EAAJ,EAAQ;AACND,MAAAA,SAAS,GAAGC,EAAE,CAACE,KAAH,CAAS,CAAT,CAAZ,CADM,CAGN;;AACA,WAAKD,GAAL,GAAWE,SAAX;AACD,KALD,MAKO;AACLJ,MAAAA,SAAS,GAAG,KAAKK,UAAjB;AACD;;AACDP,IAAAA,MAAM,CAACQ,YAAP,CAAoBN,SAApB,EAA+B,CAA/B,EAhBqE,CAkBrE;;AACA,SAAK,IAAIO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGV,SAApB,EAA+BU,CAAC,IAAI,CAApC,EAAuC;AACrCR,MAAAA,MAAM,CAACH,MAAM,GAAGW,CAAV,CAAN,IAAsBP,SAAS,CAACO,CAAD,CAA/B;AACD;AACF;AAED;AACA;AACA;;;;;;;AA7BEC,MAAAA,e,gBAAAA,e;;;qBA8BWf,G,GAAN,MAAMA,GAAN,SAAkBe,eAAlB,CAAkC,E;;AAEzCf,MAAAA,GAAG,CAACgB,SAAJ,GAAgB,cAAchB,GAAd,CAAkB;AAChCiB,QAAAA,YAAY,CAACf,KAAD,EAAQC,MAAR,EAAgB;AAC1B;AACA,gBAAME,MAAM,GAAG,KAAKa,OAApB;AACA,gBAAM;AAAEd,YAAAA;AAAF,cAAgBC,MAAtB;AAEAJ,UAAAA,2BAA2B,CAACkB,IAA5B,CAAiC,IAAjC,EAAuCjB,KAAvC,EAA8CC,MAA9C,EAAsDC,SAAtD,EAAiEC,MAAjE,EAL0B,CAO1B;;AACA,eAAKO,UAAL,GAAkBV,KAAK,CAACQ,KAAN,CAAYP,MAAZ,EAAoBA,MAAM,GAAGC,SAA7B,CAAlB;AACD;;AAV+B,OAAlC;AAYAJ,MAAAA,GAAG,CAACoB,SAAJ,GAAgB,cAAcpB,GAAd,CAAkB;AAChCiB,QAAAA,YAAY,CAACf,KAAD,EAAQC,MAAR,EAAgB;AAC1B;AACA,gBAAME,MAAM,GAAG,KAAKa,OAApB;AACA,gBAAM;AAAEd,YAAAA;AAAF,cAAgBC,MAAtB,CAH0B,CAK1B;;AACA,gBAAMgB,SAAS,GAAGnB,KAAK,CAACQ,KAAN,CAAYP,MAAZ,EAAoBA,MAAM,GAAGC,SAA7B,CAAlB;AAEAH,UAAAA,2BAA2B,CAACkB,IAA5B,CAAiC,IAAjC,EAAuCjB,KAAvC,EAA8CC,MAA9C,EAAsDC,SAAtD,EAAiEC,MAAjE,EAR0B,CAU1B;;AACA,eAAKO,UAAL,GAAkBS,SAAlB;AACD;;AAb+B,OAAlC","sourcesContent":["import {\r\n  BlockCipherMode,\r\n} from './cipher-core.js';\r\n\r\nfunction generateKeystreamAndEncrypt(words, offset, blockSize, cipher) {\r\n  const _words = words;\r\n  let keystream;\r\n\r\n  // Shortcut\r\n  const iv = this._iv;\r\n\r\n  // Generate keystream\r\n  if (iv) {\r\n    keystream = iv.slice(0);\r\n\r\n    // Remove IV for subsequent blocks\r\n    this._iv = undefined;\r\n  } else {\r\n    keystream = this._prevBlock;\r\n  }\r\n  cipher.encryptBlock(keystream, 0);\r\n\r\n  // Encrypt\r\n  for (let i = 0; i < blockSize; i += 1) {\r\n    _words[offset + i] ^= keystream[i];\r\n  }\r\n}\r\n\r\n/**\r\n * Cipher Feedback block mode.\r\n */\r\nexport class CFB extends BlockCipherMode {\r\n}\r\nCFB.Encryptor = class extends CFB {\r\n  processBlock(words, offset) {\r\n    // Shortcuts\r\n    const cipher = this._cipher;\r\n    const { blockSize } = cipher;\r\n\r\n    generateKeystreamAndEncrypt.call(this, words, offset, blockSize, cipher);\r\n\r\n    // Remember this block to use with next block\r\n    this._prevBlock = words.slice(offset, offset + blockSize);\r\n  }\r\n};\r\nCFB.Decryptor = class extends CFB {\r\n  processBlock(words, offset) {\r\n    // Shortcuts\r\n    const cipher = this._cipher;\r\n    const { blockSize } = cipher;\r\n\r\n    // Remember this block to use with next block\r\n    const thisBlock = words.slice(offset, offset + blockSize);\r\n\r\n    generateKeystreamAndEncrypt.call(this, words, offset, blockSize, cipher);\r\n\r\n    // This block becomes the previous block\r\n    this._prevBlock = thisBlock;\r\n  }\r\n};\r\n"]}