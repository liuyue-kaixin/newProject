{"version":3,"sources":["file:///Volumes/%E5%9B%BA%E6%80%81/ccProject/assets/script/battle/demos/bulletHell/bulletHell.ts"],"names":["_decorator","CCInteger","Component","instantiate","Node","Prefab","Quat","Sprite","Vec2","Vec3","cCollider","Bullet","Ghost","Player","SnailTail","Skill","Joystick","ccclass","property","tempPos","tempRot","BulletHell","type","group","inst","_inst","onLoad","onDestroy","clear","pools","length","start","node","player","addChild","phi2","a1","a2","i","schedule","objects","children","max","x","y","center","getPosition","raidus","createEnemy","cyclTime","enemy","Math","random","get","ghost","snailTail","insert","set","setPosition","init","update","dt","lateUpdate","position","lerp","camera","bg","getChildByName","sprite","getComponent","material","getSharedMaterial","uvOffset","setProperty"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;;AACjFC,MAAAA,S,iBAAAA,S;;AAEAC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,K,iBAAAA,K;;AACAC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,K,iBAAAA,K;;AACAC,MAAAA,Q,iBAAAA,Q;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBlB,U;AAExBmB,MAAAA,O,GAAU,IAAIV,IAAJ,E;AACVW,MAAAA,O,GAAU,IAAId,IAAJ,E;;4BAGHe,U,WADZJ,OAAO,CAAC,YAAD,C,UAGHC,QAAQ,CAACb,MAAD,C,UAGRa,QAAQ,CAACb,MAAD,C,UAGRa,QAAQ,CAACb,MAAD,C,UAGRa,QAAQ,CAACd,IAAD,C,UAGRc,QAAQ,CAACd,IAAD,C,UAGRc,QAAQ,CAACd,IAAD,C,UAGRc,QAAQ;AAAA;AAAA,+B,UAMRA,QAAQ,CAAC;AAAEI,QAAAA,IAAI,EAAErB,SAAR;AAAmBsB,QAAAA,KAAK,EAAE;AAA1B,OAAD,C,WAGRL,QAAQ,CAAC;AAAEK,QAAAA,KAAK,EAAE;AAAT,OAAD,C,WAGRL,QAAQ,CAAC;AAAEK,QAAAA,KAAK,EAAE;AAAT,OAAD,C,sCAjCb,MACaF,UADb,SACgCnB,SADhC,CAC0C;AAAA;AAAA;;AAAA;;AAGf;AAHe;;AAMX;AANW;;AASd;AATc;;AAYf;AAZe;;AAef;AAfe;;AAkBhB;AAlBgB;;AAqBV;AAI5B;AAzBsC;;AA2BlB;AA3BkB;;AA8Bf;AA9Be;AAAA;;AAwCvB,mBAAJsB,IAAI,GAAG;AACd,iBAAO,KAAKC,KAAZ;AACH;;AAEDC,QAAAA,MAAM,GAAS;AACXL,UAAAA,UAAU,CAACI,KAAX,GAAmB,IAAnB;AACH;;AAEDE,QAAAA,SAAS,GAAS;AAEd;AAAA;AAAA,sCAAUH,IAAV,CAAeI,KAAf;AACA;AAAA;AAAA,8BAAMC,KAAN,CAAYC,MAAZ,GAAqB,CAArB;AACA;AAAA;AAAA,8BAAMD,KAAN,CAAYC,MAAZ,GAAqB,CAArB;AACA;AAAA;AAAA,gCAAOD,KAAP,CAAaC,MAAb,GAAsB,CAAtB;AACA;AAAA;AAAA,sCAAUD,KAAV,CAAgBC,MAAhB,GAAyB,CAAzB;AACH;;AAEDC,QAAAA,KAAK,GAAS;AAEV;AACA,cAAIC,IAAI,GAAG7B,WAAW,CAAC,KAAK8B,MAAN,CAAtB;AACA,eAAKD,IAAL,CAAUE,QAAV,CAAmBF,IAAnB;AAEA,gBAAMG,IAAI,GAAG,kBAAb;AACA,gBAAMC,EAAE,GAAG,OAAOD,IAAI,GAAGA,IAAd,CAAX;AACA,gBAAME,EAAE,GAAG,MAAMF,IAAjB,CARU,CAUV;;AACA,cAAIG,CAAC,GAAG,CAAR;AACA,eAAKC,QAAL,CAAc,MAAM;AAEhB,gBAAI,KAAKC,OAAL,CAAaC,QAAb,CAAsBX,MAAtB,GAA+B,KAAKY,GAAxC,EAA6C;AACzC,kBAAIC,CAAC,GAAG,CAAC,MAAMN,EAAE,GAAGC,CAAZ,IAAiB,CAAzB;AACA,kBAAIM,CAAC,GAAG,CAAC,MAAMR,EAAE,GAAGE,CAAZ,IAAiB,CAAzB;AACA,kBAAIO,MAAM,GAAG;AAAA;AAAA,oCAAOrB,IAAP,CAAYsB,WAAZ,EAAb;AACAH,cAAAA,CAAC,GAAG,CAACA,CAAC,GAAG,GAAL,IAAY,KAAKI,MAAjB,GAA0BF,MAAM,CAACF,CAArC;AACAC,cAAAA,CAAC,GAAG,CAACA,CAAC,GAAG,GAAL,IAAY,KAAKG,MAAjB,GAA0BF,MAAM,CAACD,CAArC;AACA,mBAAKI,WAAL,CAAiBL,CAAjB,EAAoBC,CAApB;AACAN,cAAAA,CAAC;AACJ;AAEJ,WAZD,EAYG,KAAKW,QAZR;AAaH;;AAEDD,QAAAA,WAAW,CAACL,CAAD,EAAYC,CAAZ,EAAuB;AAAA;;AAE9B,cAAIM,KAAJ,CAF8B,CAI9B;;AACA,cAAIC,IAAI,CAACC,MAAL,KAAgB,GAApB,EACIF,KAAK,GAAG;AAAA;AAAA,8BAAMG,GAAN,CAAU,KAAKC,KAAf,CAAR,CADJ,KAGIJ,KAAK,GAAG;AAAA;AAAA,sCAAUG,GAAV,CAAc,KAAKE,SAAnB,CAAR;AAEJ,oBAAAL,KAAK,SAAL,WAAOM,MAAP,CAAc,KAAKhB,OAAnB;AAEArB,UAAAA,OAAO,CAACsC,GAAR,CAAYd,CAAZ,EAAcC,CAAd,EAAgB,CAAhB;AACA,qBAAAM,KAAK,SAAL,YAAOQ,WAAP,CAAmBvC,OAAnB;AAEA,qBAAA+B,KAAK,SAAL,YAAOS,IAAP,GAf8B,CAef;AAClB;;AAESC,QAAAA,MAAM,CAACC,EAAD,EAAmB;AAC/B;AACA;AAAA;AAAA,sCAAUrC,IAAV,CAAeoC,MAAf,CAAsBC,EAAtB;AACH;;AAEDC,QAAAA,UAAU,CAACD,EAAD,EAAmB;AAEzB;AACA,gBAAME,QAAQ,GAAG;AAAA;AAAA,gCAAOvC,IAAP,CAAYsB,WAAZ,EAAjB;AACArC,UAAAA,IAAI,CAACuD,IAAL,CAAU7C,OAAV,EAAmB,KAAK8C,MAAL,CAAYF,QAA/B,EAAyCA,QAAzC,EAAmD,IAAnD;AACA,eAAKE,MAAL,CAAYF,QAAZ,GAAuB5C,OAAvB,CALyB,CAOzB;;AACA,cAAI+C,EAAE,GAAG,KAAKlC,IAAL,CAAUmC,cAAV,CAAyB,IAAzB,CAAT;AACA,cAAIC,MAAM,GAAGF,EAAH,oBAAGA,EAAE,CAAEG,YAAJ,CAAiB9D,MAAjB,CAAb;AACA,cAAI+D,QAAQ,GAAGF,MAAH,oBAAGA,MAAM,CAAEG,iBAAR,CAA0B,CAA1B,CAAf;AACA,cAAIC,QAAQ,GAAG,IAAIhE,IAAJ,CAASuD,QAAQ,CAACpB,CAAT,GAAa,KAAtB,EAA6B,CAACoB,QAAQ,CAACnB,CAAV,GAAc,KAA3C,CAAf;AACA0B,UAAAA,QAAQ,QAAR,IAAAA,QAAQ,CAAEG,WAAV,CAAsB,cAAtB,EAAsCD,QAAtC;AACAN,UAAAA,EAAE,CAAEH,QAAJ,GAAeA,QAAf;AAEH;;AA1HqC,O,UAuCvBtC,K;;;;;iBApCC,I;;;;;;;iBAGI,I;;;;;;;iBAGH,I;;;;;;;iBAGD,I;;;;;;;iBAGA,I;;;;;;;iBAGD,I;;;;;;;iBAGM,I;;;;;;;iBAMP,I;;;;;;;iBAGG,I;;;;;;;iBAGE,I","sourcesContent":["import { _decorator, CCInteger, Component, instantiate, Node, Prefab, Quat, Sprite, Vec2, Vec3 } from 'cc';\nimport { cCollider } from '../../collision/Collider';\nimport { cObject } from '../../collision/Object';\nimport { Bullet } from './bullet';\nimport { Ghost } from './ghost';\nimport { Player } from './player';\nimport { SnailTail } from './snailTail';\nimport { Skill } from './skill';\nimport { Joystick } from '../../Joystick';\nconst { ccclass, property } = _decorator;\n\nconst tempPos = new Vec3();\nconst tempRot = new Quat();\n\n@ccclass('BulletHell')\nexport class BulletHell extends Component {\n\n    @property(Prefab)\n    ghost: Prefab = null!; //敌人\n\n    @property(Prefab)\n    snailTail: Prefab = null!; //敌人\n\n    @property(Prefab)\n    player: Prefab = null!; //主角\n\n    @property(Node)\n    objects: Node = null!; //enemy 显示挂载点\n\n    @property(Node)\n    bullets: Node = null!; //bullet 显示挂载点\n\n    @property(Node)\n    camera: Node = null!; //跟随相机\n\n    @property(Joystick)\n    joystick: Joystick = null!; //主角摇杆\n\n\n\n    //简单模拟在周期时间内，以主角为中心的半径内产生敌人\n    @property({ type: CCInteger, group: \"Enemy Config\" })\n    max: number = 1000; //多敌人同屏数\n\n    @property({ group: \"Enemy Config\" })\n    raidus: number = 2000; //刷怪最大半径 \n\n    @property({ group: \"Enemy Config\" })\n    cyclTime: number = 0.03; //刷怪cd周期\n\n    //自行扩展控制策略\n    //....\n\n\n    private static _inst: BulletHell;\n    static get inst() {\n        return this._inst;\n    }\n\n    onLoad(): void {\n        BulletHell._inst = this;\n    }\n\n    onDestroy(): void {\n\n        cCollider.inst.clear();\n        Ghost.pools.length = 0;\n        Skill.pools.length = 0;\n        Bullet.pools.length = 0;\n        SnailTail.pools.length = 0;\n    }\n\n    start(): void {\n\n        //创建主角直接挂在场景下\n        let node = instantiate(this.player);\n        this.node.addChild(node);\n\n        const phi2 = 1.3247179572447458;\n        const a1 = 1.0 / (phi2 * phi2);\n        const a2 = 1.0 / phi2;\n\n        //定时刷怪\n        let i = 1;\n        this.schedule(() => {\n\n            if (this.objects.children.length < this.max) {\n                let x = (0.5 + a2 * i) % 1;\n                let y = (0.5 + a1 * i) % 1;\n                let center = Player.inst.getPosition();\n                x = (x - 0.5) * this.raidus + center.x;\n                y = (y - 0.5) * this.raidus + center.y;\n                this.createEnemy(x, y);\n                i++;\n            }\n\n        }, this.cyclTime);\n    }\n\n    createEnemy(x: number, y: number) {\n\n        let enemy: cObject | undefined | null;\n\n        //随机产生两种\n        if (Math.random() > 0.5)\n            enemy = Ghost.get(this.ghost);\n        else\n            enemy = SnailTail.get(this.snailTail);\n\n        enemy?.insert(this.objects);\n\n        tempPos.set(x,y,0);\n        enemy?.setPosition(tempPos);\n\n        enemy?.init(); //初始化\n    }\n\n    protected update(dt: number): void {\n        //运行碰撞检测\n        cCollider.inst.update(dt);\n    }\n\n    lateUpdate(dt: number): void {\n\n        //相机跟随\n        const position = Player.inst.getPosition();\n        Vec3.lerp(tempPos, this.camera.position, position, 0.25);\n        this.camera.position = tempPos;\n\n        //背景跟随\n        let bg = this.node.getChildByName(\"bg\");\n        let sprite = bg?.getComponent(Sprite);\n        let material = sprite?.getSharedMaterial(0);\n        let uvOffset = new Vec2(position.x / 512.0, -position.y / 512.0);\n        material?.setProperty(\"tilingOffset\", uvOffset);\n        bg!.position = position;\n\n    }\n\n}\n\n"]}