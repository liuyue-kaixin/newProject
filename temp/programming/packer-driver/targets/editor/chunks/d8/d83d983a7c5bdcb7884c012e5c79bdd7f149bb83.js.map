{"version":3,"sources":["file:///Volumes/SSD/ccProject/assets/script/battle/demos/bulletHell/enemy.ts"],"names":["_decorator","Quat","Vec3","cObject","Trigger","Player","PhysicsGroup","ccclass","property","tempPos","tempRot","Enemy","PLAYER","BULLET","init","follow","velocity","set","tryVelocity","update","dt","pos","getPosition","x","y","z","setPosition","scale","node","worldScale","worldPosition","tartet","inst","subtract","normalize","maxVelocity","body","multiplyScalar","Math","abs","setScale","onTrigger","b","trigger","exit","group"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAgDC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;;AAEtDC,MAAAA,O,iBAAAA,O;AAASC,MAAAA,O,iBAAAA,O;;AACTC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,Y,iBAAAA,Y;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;AAExBS,MAAAA,O,GAAU,IAAIP,IAAJ,E;AACVQ,MAAAA,O,GAAU,IAAIT,IAAJ,E;;uBAEHU,K,WADZJ,OAAO,CAAC,OAAD,C,gBAAR,MACaI,KADb;AAAA;AAAA,8BACmC;AAAA;AAAA;AAE/B;AAF+B,eAG/BC,MAH+B,GAGtB;AAAA;AAAA,4CAAa,QAAb,CAHsB;AAAA,eAI/BC,MAJ+B,GAItB;AAAA;AAAA,4CAAa,QAAb,CAJsB;AAAA;;AAM/BC,QAAAA,IAAI,GAAS;AACT;AACA,eAAKC,MAAL,GAFS,CAEK;;AACd,eAAKC,QAAL,CAAcC,GAAd,CAAkB,KAAKC,WAAvB;AACH;;AAEDC,QAAAA,MAAM,CAACC,EAAD,EAAa;AAEf;AACA,cAAIC,GAAG,GAAG,KAAKC,WAAL,EAAV;AACA,cAAIN,QAAQ,GAAG,KAAKA,QAApB;AACAP,UAAAA,OAAO,CAACc,CAAR,GAAYF,GAAG,CAACE,CAAJ,GAAQP,QAAQ,CAACO,CAAT,GAAaH,EAAjC;AACAX,UAAAA,OAAO,CAACe,CAAR,GAAYH,GAAG,CAACG,CAAJ,GAAQR,QAAQ,CAACQ,CAAT,GAAaJ,EAAjC;AACAX,UAAAA,OAAO,CAACgB,CAAR,GAAYJ,GAAG,CAACI,CAAJ,GAAQT,QAAQ,CAACS,CAAT,GAAaL,EAAjC;AACA,eAAKM,WAAL,CAAiBjB,OAAjB;AAEA,eAAKM,MAAL;AACH,SAvB8B,CAyB/B;;;AACAA,QAAAA,MAAM,GAAG;AAEL,cAAIY,KAAK,GAAG,KAAKC,IAAL,CAAUC,UAAtB;AACA,cAAIR,GAAG,GAAG,KAAKO,IAAL,CAAUE,aAApB;AACA,cAAIC,MAAM,GAAG;AAAA;AAAA,gCAAOC,IAAP,CAAYJ,IAAZ,CAAiBE,aAA9B;AACA5B,UAAAA,IAAI,CAAC+B,QAAL,CAAc,KAAKf,WAAnB,EAAgCa,MAAhC,EAAwCV,GAAxC,EAA6Ca,SAA7C,GALK,CAOL;;AACA,cAAIC,WAAW,GAAG,KAAKC,IAAL,CAAUD,WAA5B;AACA,eAAKjB,WAAL,CAAiBmB,cAAjB,CAAgCF,WAAhC,EATK,CAWL;;AACA,cAAIZ,CAAC,GAAGe,IAAI,CAACC,GAAL,CAASZ,KAAK,CAACJ,CAAf,CAAR;AAAA,cAA0BC,CAAC,GAAGG,KAAK,CAACH,CAApC;AAAA,cAAsCC,CAAC,GAAGE,KAAK,CAACF,CAAhD;AACAE,UAAAA,KAAK,CAACV,GAAN,CAAUM,CAAC,IAAE,KAAKL,WAAL,CAAiBK,CAAjB,GAAmB,CAAnB,GAAqB,CAAC,CAAtB,GAAwB,CAA1B,CAAX,EAAwCC,CAAxC,EAA0CC,CAA1C;AACA,eAAKe,QAAL,CAAcb,KAAd;AACH;;AAGDc,QAAAA,SAAS,CAACC,CAAD,EAAUC,OAAV,EAA4B;AACjC,cAAGA,OAAO,IAAI;AAAA;AAAA,kCAAQC,IAAtB,EAA6B;;AAC7B,kBAAQF,CAAC,CAACG,KAAV;AACI,iBAAK,KAAKhC,MAAV;AAAkB;AACd;;AACJ,iBAAK,KAAKD,MAAV;AAAkB;AACd;AAJR;AAMH;;AApD8B,O","sourcesContent":["import { _decorator, instantiate, PhysicsSystem, Prefab, Quat, Vec3 } from 'cc';\nimport { cBody } from '../../collision/Body';\nimport { cObject, Trigger } from '../../collision/Object';\nimport { Player } from './player';\nimport { PhysicsGroup } from '../../../game/common/config/ConstDefine';\nconst { ccclass, property } = _decorator;\n\nconst tempPos = new Vec3();\nconst tempRot = new Quat();\n@ccclass('Enemy')\nexport class Enemy extends cObject {\n\n    //获取默认物理控制面板的分组信息\n    PLAYER = PhysicsGroup[\"player\"];\n    BULLET = PhysicsGroup[\"bullet\"];\n\n    init(): void {\n        //重置状态\n        this.follow();//跟随速度和方向\n        this.velocity.set(this.tryVelocity);\n    }\n\n    update(dt: number) {\n\n        //计算新位置\n        let pos = this.getPosition();\n        let velocity = this.velocity;\n        tempPos.x = pos.x + velocity.x * dt;\n        tempPos.y = pos.y + velocity.y * dt;\n        tempPos.z = pos.z + velocity.z * dt;\n        this.setPosition(tempPos);\n\n        this.follow();\n    }\n\n    //跟随主角\n    follow() {\n\n        let scale = this.node.worldScale; \n        let pos = this.node.worldPosition; \n        let tartet = Player.inst.node.worldPosition;\n        Vec3.subtract(this.tryVelocity, tartet, pos).normalize();\n\n        //尝试最大跟随速度(有需要，可以自己设置)\n        let maxVelocity = this.body.maxVelocity;\n        this.tryVelocity.multiplyScalar(maxVelocity);\n    \n        //调整转向\n        let x = Math.abs(scale.x),y = scale.y,z = scale.z;\n        scale.set(x*(this.tryVelocity.x<0?-1:1),y,z);\n        this.setScale(scale);\n    }\n\n\n    onTrigger(b: cBody,trigger: Trigger) {\n        if(trigger == Trigger.exit ) return;\n        switch (b.group) {\n            case this.BULLET: //碰到子弹\n                break;\n            case this.PLAYER: //碰到player\n                break;\n        }\n    }\n}\n\n"]}