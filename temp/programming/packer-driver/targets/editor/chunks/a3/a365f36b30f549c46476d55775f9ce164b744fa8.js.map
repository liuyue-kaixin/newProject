{"version":3,"sources":["file:///Volumes/%E5%9B%BA%E6%80%81/ccProject/extensions/oops-plugin-framework/assets/core/gui/layer/DelegateComponent.ts"],"names":["Component","_decorator","oops","ccclass","DelegateComponent","viewParams","add","applyComponentsFunction","node","params","callbacks","onAdded","remove","isDestroy","valid","onBeforeRemove","removed","onRemoved","destroy","res","release","prefabPath","removeFromParent","onDestroy","funName","i","components","length","component","func","call"],"mappings":";;;;;;;;;;;;;;;;;;;;AAMSA,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,U,OAAAA,U;;AACjBC,MAAAA,I,iBAAAA,I;;;;;;AAPT;AACA;AACA;AACA;AACA;AACA;;;;;OAKM;AAAEC,QAAAA;AAAF,O,GAAcF,U;AAEpB;;mCAEaG,iB,WADZD,OAAO,CAAC,mBAAD,C,gBAAR,MACaC,iBADb,SACuCJ,SADvC,CACiD;AAAA;AAAA;;AAC7C;AAD6C,eAE7CK,UAF6C,GAEpB,IAFoB;AAAA;;AAI7C;AACAC,QAAAA,GAAG,GAAG;AACF;AACA,eAAKC,uBAAL,CAA6B,KAAKC,IAAlC,EAAwC,SAAxC,EAAmD,KAAKH,UAAL,CAAgBI,MAAnE;;AACA,cAAI,OAAO,KAAKJ,UAAL,CAAgBK,SAAhB,CAA0BC,OAAjC,KAA6C,UAAjD,EAA6D;AACzD,iBAAKN,UAAL,CAAgBK,SAAhB,CAA0BC,OAA1B,CAAkC,KAAKH,IAAvC,EAA6C,KAAKH,UAAL,CAAgBI,MAA7D;AACH;AACJ;AAED;;;AACAG,QAAAA,MAAM,CAACC,SAAD,EAAqB;AACvB,cAAI,KAAKR,UAAL,CAAgBS,KAApB,EAA2B;AACvB;AACA,iBAAKP,uBAAL,CAA6B,KAAKC,IAAlC,EAAwC,gBAAxC,EAA0D,KAAKH,UAAL,CAAgBI,MAA1E,EAFuB,CAIvB;;AACA,gBAAI,OAAO,KAAKJ,UAAL,CAAgBK,SAAhB,CAA0BK,cAAjC,KAAoD,UAAxD,EAAoE;AAChE,mBAAKV,UAAL,CAAgBK,SAAhB,CAA0BK,cAA1B,CACI,KAAKP,IADT,EAEI,MAAM;AACF,qBAAKQ,OAAL,CAAa,KAAKX,UAAlB,EAA8BQ,SAA9B;AACH,eAJL;AAKH,aAND,MAOK;AACD,mBAAKG,OAAL,CAAa,KAAKX,UAAlB,EAA8BQ,SAA9B;AACH;AACJ;AACJ;AAED;;;AACQG,QAAAA,OAAO,CAACX,UAAD,EAAyBQ,SAAzB,EAA6C;AACxDR,UAAAA,UAAU,CAACS,KAAX,GAAmB,KAAnB;;AAEA,cAAI,OAAOT,UAAU,CAACK,SAAX,CAAqBO,SAA5B,KAA0C,UAA9C,EAA0D;AACtDZ,YAAAA,UAAU,CAACK,SAAX,CAAsBO,SAAtB,CAAgC,KAAKT,IAArC,EAA2CH,UAAU,CAACI,MAAtD;AACH;;AAED,cAAII,SAAJ,EAAe;AACX,iBAAKL,IAAL,CAAUU,OAAV,GADW,CAGX;;AACA;AAAA;AAAA,8BAAKC,GAAL,CAASC,OAAT,CAAiBf,UAAU,CAACgB,UAA5B;AACH,WALD,MAMK;AACD,iBAAKb,IAAL,CAAUc,gBAAV;AACH;AACJ;;AAEDC,QAAAA,SAAS,GAAG;AACR;AACA,eAAKhB,uBAAL,CAA6B,KAAKC,IAAlC,EAAwC,WAAxC,EAAqD,KAAKH,UAAL,CAAgBI,MAArE,EAFQ,CAIR;AACA;AACA;AACA;;AAEA,eAAKJ,UAAL,GAAkB,IAAlB;AACH;;AAESE,QAAAA,uBAAuB,CAACC,IAAD,EAAagB,OAAb,EAA8Bf,MAA9B,EAA2C;AACxE,eAAK,IAAIgB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGjB,IAAI,CAACkB,UAAL,CAAgBC,MAApC,EAA4CF,CAAC,EAA7C,EAAiD;AAC7C,gBAAIG,SAAc,GAAGpB,IAAI,CAACkB,UAAL,CAAgBD,CAAhB,CAArB;AACA,gBAAII,IAAI,GAAGD,SAAS,CAACJ,OAAD,CAApB;;AACA,gBAAIK,IAAJ,EAAU;AACNA,cAAAA,IAAI,CAACC,IAAL,CAAUF,SAAV,EAAqBnB,MAArB;AACH;AACJ;AACJ;;AAxE4C,O","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2022-09-01 18:00:28\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2023-01-09 11:55:03\r\n */\r\nimport { Component, Node, _decorator } from \"cc\";\r\nimport { oops } from \"../../Oops\";\r\nimport { ViewParams } from \"./Defines\";\r\n\r\nconst { ccclass } = _decorator;\r\n\r\n/** 窗口事件触发组件 */\r\n@ccclass('DelegateComponent')\r\nexport class DelegateComponent extends Component {\r\n    /** 视图参数 */\r\n    viewParams: ViewParams = null!;\r\n\r\n    /** 窗口添加 */\r\n    add() {\r\n        // 触发窗口组件上添加到父节点后的事件\r\n        this.applyComponentsFunction(this.node, \"onAdded\", this.viewParams.params);\r\n        if (typeof this.viewParams.callbacks.onAdded === \"function\") {\r\n            this.viewParams.callbacks.onAdded(this.node, this.viewParams.params);\r\n        }\r\n    }\r\n\r\n    /** 删除节点，该方法只能调用一次，将会触发onBeforeRemoved回调 */\r\n    remove(isDestroy: boolean) {\r\n        if (this.viewParams.valid) {\r\n            // 触发窗口组件上移除之前的事件\r\n            this.applyComponentsFunction(this.node, \"onBeforeRemove\", this.viewParams.params);\r\n\r\n            //  通知外部对象窗口组件上移除之前的事件（关闭窗口前的关闭动画处理）\r\n            if (typeof this.viewParams.callbacks.onBeforeRemove === \"function\") {\r\n                this.viewParams.callbacks.onBeforeRemove(\r\n                    this.node,\r\n                    () => {\r\n                        this.removed(this.viewParams, isDestroy);\r\n                    });\r\n            }\r\n            else {\r\n                this.removed(this.viewParams, isDestroy);\r\n            }\r\n        }\r\n    }\r\n\r\n    /** 窗口组件中触发移除事件与释放窗口对象 */\r\n    private removed(viewParams: ViewParams, isDestroy: boolean) {\r\n        viewParams.valid = false;\r\n\r\n        if (typeof viewParams.callbacks.onRemoved === \"function\") {\r\n            viewParams.callbacks!.onRemoved(this.node, viewParams.params);\r\n        }\r\n\r\n        if (isDestroy) {\r\n            this.node.destroy();\r\n\r\n            // 释放界面相关资源\r\n            oops.res.release(viewParams.prefabPath);\r\n        }\r\n        else {\r\n            this.node.removeFromParent();\r\n        }\r\n    }\r\n\r\n    onDestroy() {\r\n        // 触发窗口组件上窗口移除之后的事件\r\n        this.applyComponentsFunction(this.node, \"onRemoved\", this.viewParams.params);\r\n\r\n        // 通知外部对象窗口移除之后的事件\r\n        // if (typeof this.viewParams.callbacks!.onRemoved === \"function\") {\r\n        //     this.viewParams.callbacks!.onRemoved(this.node, this.viewParams.params);\r\n        // }\r\n\r\n        this.viewParams = null!;\r\n    }\r\n\r\n    protected applyComponentsFunction(node: Node, funName: string, params: any) {\r\n        for (let i = 0; i < node.components.length; i++) {\r\n            let component: any = node.components[i];\r\n            let func = component[funName];\r\n            if (func) {\r\n                func.call(component, params);\r\n            }\r\n        }\r\n    }\r\n}"]}