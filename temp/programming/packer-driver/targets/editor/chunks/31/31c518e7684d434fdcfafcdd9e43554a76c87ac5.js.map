{"version":3,"sources":["file:///Volumes/%E5%9B%BA%E6%80%81/ccProject/extensions/oops-plugin-framework/assets/libs/gui/label/LabelChange.ts"],"names":["_decorator","LabelNumber","ccclass","property","menu","LabelChange","duration","callback","isBegin","speed","end","changeTo","playAnim","num","changeBy","value","stop","excCallback","begin","isEnd","update","dt","isInteger","Math","floor","ceil"],"mappings":"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","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2022-04-14 17:08:01\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2023-08-11 10:00:51\r\n */\r\nimport { _decorator } from \"cc\";\r\nimport LabelNumber from \"./LabelNumber\";\r\n\r\nconst { ccclass, property, menu } = _decorator;\r\n\r\n/** 数值变化动画标签组件 */\r\n@ccclass(\"LabelChange\")\r\n@menu('ui/label/LabelChange')\r\nexport class LabelChange extends LabelNumber {\r\n    @property\r\n    isInteger: boolean = false;\r\n\r\n    private duration: number = 0;            // 持续时间\r\n    private callback: Function | undefined;  // 完成回调\r\n    private isBegin: boolean = false;        // 是否开始\r\n    private speed: number = 0;               // 变化速度\r\n    private end: number = 0;                 // 最终值\r\n\r\n    /**\r\n     * 变化到某值,如果从当前开始的begin传入null\r\n     * @param {number} duration \r\n     * @param {number} end \r\n     * @param {Function} [callback]\r\n     */\r\n    public changeTo(duration: number, end: number, callback?: Function) {\r\n        if (duration == 0) {\r\n            if (callback) callback();\r\n            return;\r\n        }\r\n        this.playAnim(duration, this.num, end, callback);\r\n    }\r\n\r\n\r\n    /**\r\n     * 变化值,如果从当前开始的begin传入null\r\n     * @param {number} duration \r\n     * @param {number} value \r\n     * @param {Function} [callback] \r\n     * @memberof LabelChange\r\n     */\r\n    public changeBy(duration: number, value: number, callback?: Function) {\r\n        if (duration == 0) {\r\n            if (callback) callback();\r\n            return;\r\n        }\r\n        this.playAnim(duration, this.num, this.num + value, callback);\r\n    }\r\n\r\n    /** 立刻停止 */\r\n    public stop(excCallback: boolean = true) {\r\n        this.num = this.end;\r\n        this.isBegin = false;\r\n        if (excCallback && this.callback) this.callback();\r\n    }\r\n\r\n    /** 播放动画 */\r\n    private playAnim(duration: number, begin: number, end: number, callback?: Function) {\r\n        this.duration = duration;\r\n        this.end = end;\r\n        this.callback = callback;\r\n        this.speed = (end - begin) / duration;\r\n\r\n        this.num = begin;\r\n        this.isBegin = true;\r\n    }\r\n\r\n    /** 是否已经结束 */\r\n    private isEnd(num: number): boolean {\r\n        if (this.speed > 0) {\r\n            return num >= this.end;\r\n        }\r\n        else {\r\n            return num <= this.end;\r\n        }\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (this.isBegin) {\r\n            if (this.num == this.end) {\r\n                this.isBegin = false;\r\n                if (this.callback) this.callback();\r\n                return;\r\n            }\r\n            let num = this.num + dt * this.speed;\r\n\r\n            if (this.isInteger){\r\n                if(this.end < this.num)\r\n                {\r\n                    num = Math.floor(num);\r\n                }\r\n                else{\r\n                    num = Math.ceil(num);\r\n                }\r\n            }\r\n\r\n            /** 变化完成 */\r\n            if (this.isEnd(num)) {\r\n                num = this.end;\r\n                this.isBegin = false;\r\n                if (this.callback) this.callback();\r\n            }\r\n            this.num = num;\r\n        }\r\n    }\r\n}"]}