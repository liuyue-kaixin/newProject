{"version":3,"sources":["file:///Volumes/SSD%201/ccProject/extensions/oops-plugin-framework/assets/libs/model-view/ui/BhvSwitchPage.ts"],"names":["CCInteger","Component","_decorator","VMEnv","ccclass","property","executeInEditMode","menu","BhvSwitchPage","type","preIndex","_isChanging","index","_index","v","isChanging","Math","round","count","node","children","length","isLoopPage","editor","_updateEditorPage","_updatePage","onLoad","page","i","active","curIndex","preNode","showNode","next","previous","setEventIndex","e"],"mappings":"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","sourcesContent":["import { CCInteger, Component, Node, _decorator } from \"cc\";\r\nimport { VMEnv } from \"../VMEnv\";\r\n\r\nconst { ccclass, property, executeInEditMode, menu } = _decorator;\r\n\r\n@ccclass\r\n@executeInEditMode\r\n@menu(\"添加特殊行为/UI/Switch Page (切换页面)\")\r\nexport class BhvSwitchPage extends Component {\r\n    @property\r\n    isLoopPage: boolean = false;\r\n\r\n    @property\r\n    private _index: number = 0;\r\n    public get index(): number {\r\n        return this._index;\r\n    }\r\n    @property({\r\n        type: CCInteger\r\n    })\r\n    public set index(v: number) {\r\n        if (this.isChanging) return;\r\n        v = Math.round(v);\r\n        let count = this.node.children.length - 1;\r\n\r\n        if (this.isLoopPage) {\r\n            if (v > count) v = 0;\r\n            if (v < 0) v = count;\r\n        }\r\n        else {\r\n            if (v > count) v = count;\r\n            if (v < 0) v = 0;\r\n        }\r\n        this.preIndex = this._index;//标记之前的页面\r\n        this._index = v;\r\n\r\n        if (VMEnv.editor) {\r\n            this._updateEditorPage(v);\r\n        }\r\n        else {\r\n            this._updatePage(v);\r\n        }\r\n    }\r\n\r\n    private preIndex: number = 0;\r\n\r\n    //判断是否在 changing 页面状态\r\n\r\n    private _isChanging: boolean = false;\r\n    /**只读，是否在changing 的状态 */\r\n    public get isChanging(): boolean {\r\n        return this._isChanging;\r\n    }\r\n\r\n    onLoad() {\r\n        this.preIndex = this.index;\r\n    }\r\n\r\n    private _updateEditorPage(page: number) {\r\n        if (!VMEnv.editor) return;\r\n\r\n        let children = this.node.children;\r\n        for (let i = 0; i < children.length; i++) {\r\n            const node = children[i];\r\n            if (i == page) {\r\n                node.active = true;\r\n            }\r\n            else {\r\n                node.active = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    private _updatePage(page: number) {\r\n        let children = this.node.children;\r\n        let preIndex = this.preIndex;\r\n        let curIndex = this.index;\r\n        if (preIndex === curIndex) return;//没有改变就不进行操作\r\n\r\n        let preNode: Node = children[preIndex];//旧节点\r\n        let showNode: Node = children[curIndex];//新节点\r\n\r\n        preNode.active = false;\r\n        showNode.active = true;\r\n    }\r\n\r\n    public next(): boolean {\r\n        if (this.isChanging) {\r\n            return false;\r\n        }\r\n        else {\r\n            this.index++;\r\n            return true;\r\n        }\r\n    }\r\n\r\n    public previous(): boolean {\r\n        if (this.isChanging) {\r\n            return false;\r\n        }\r\n        else {\r\n            this.index--;\r\n            return true;\r\n        }\r\n    }\r\n\r\n    public setEventIndex(e: any, index: any): boolean {\r\n        if (this.index >= 0 && this.index != null && this.isChanging === false) {\r\n            this.index = index;\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    }\r\n}\r\n"]}