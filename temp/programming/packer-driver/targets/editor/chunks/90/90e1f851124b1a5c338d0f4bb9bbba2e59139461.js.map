{"version":3,"sources":["file:///Volumes/SSD%201/ccProject/extensions/oops-plugin-framework/assets/libs/gui/label/LabelTime.ts"],"names":["Label","_decorator","ccclass","property","menu","LabelTime","tooltip","dateDisable","result","onSecond","onComplete","replace","value","args","m","i","format","c","countDown","date","Math","floor","hours","minutes","seconds","zeroize","timeFormat","dataFormat","dayFormat","index","indexOf","substring","df","coverString","string","toString","setDateDisable","flag","setTime","second","timing_end","timing_start","start","onScheduleSecond","node","onScheduleComplete","schedule","unscheduleAllCallbacks"],"mappings":"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","sourcesContent":["import { Label, _decorator } from \"cc\";\r\n\r\nconst { ccclass, property, menu } = _decorator;\r\n\r\n@ccclass(\"LabelTime\")\r\n@menu('ui/label/LabelTime')\r\nexport default class LabelTime extends Label {\r\n    @property({\r\n        tooltip: \"到计时间总时间（单位秒）\"\r\n    })\r\n    countDown: number = 1000;\r\n\r\n    @property({\r\n        tooltip: \"天数数据格式化\"\r\n    })\r\n    dayFormat: string = \"{0} day\";\r\n\r\n    @property({\r\n        tooltip: \"时间格式化\"\r\n    })\r\n    timeFormat: string = \"{0}:{1}:{2}\";\r\n\r\n    @property({\r\n        tooltip: \"是否有00\"\r\n    })\r\n    zeroize: boolean = true;\r\n\r\n    private dateDisable!: boolean;\r\n    private result!: string;\r\n\r\n    /** 每秒触发事件 */\r\n    onSecond: Function = null!;\r\n    /** 倒计时完成事件 */\r\n    onComplete: Function = null!;\r\n\r\n    private replace(value: string, ...args: any): string {\r\n        return value.replace(/\\{(\\d+)\\}/g,\r\n            function (m, i) {\r\n                return args[i];\r\n            });\r\n    }\r\n\r\n    /** 格式化字符串 */\r\n    private format() {\r\n        let c: number = this.countDown;\r\n        let date: number = Math.floor(c / 86400);\r\n        c = c - date * 86400;\r\n        let hours: number = Math.floor(c / 3600);\r\n        c = c - hours * 3600;\r\n        let minutes: number = Math.floor(c / 60);\r\n        c = c - minutes * 60;\r\n        let seconds: number = c;\r\n\r\n        this.dateDisable = this.dateDisable || false;\r\n        if (date == 0 && hours == 0 && minutes == 0 && seconds == 0) {\r\n            if (this.zeroize) {\r\n                this.result = this.replace(this.timeFormat, \"00\", \"00\", \"00\");\r\n            }\r\n            else {\r\n                this.result = this.replace(this.timeFormat, \"0\", \"0\", \"0\");\r\n            }\r\n        }\r\n        else if (date > 0 && !this.dateDisable) {\r\n            let dataFormat = this.dayFormat;\r\n            let index = dataFormat.indexOf(\"{1}\");\r\n            if (hours == 0 && index > -1) {\r\n                dataFormat = dataFormat.substring(0, index - 1);\r\n            }\r\n            let df = dataFormat;\r\n            if (date > 1 && dataFormat.indexOf(\"days\") < 0) {\r\n                df = df.replace(\"day\", \"days\");\r\n            }\r\n            if (date < 2) {\r\n                df = df.replace(\"days\", \"day\");\r\n            }\r\n            this.result = this.replace(df, date, hours);                      // 如果天大于1，则显示 \"1 Day...\"\r\n        }\r\n        else {\r\n            hours += date * 24;\r\n            if (this.zeroize) {\r\n                this.result = this.replace(\r\n                    this.timeFormat,\r\n                    this.coverString(hours),\r\n                    this.coverString(minutes),\r\n                    this.coverString(seconds));                                            // 否则显示 \"01:12:24\"\r\n            }\r\n            else {\r\n                this.result = this.replace(\r\n                    this.timeFormat,\r\n                    hours,\r\n                    minutes,\r\n                    seconds);\r\n            }\r\n        }\r\n        this.string = this.result;\r\n    }\r\n\r\n    /** 个位数的时间数据将字符串补位 */\r\n    private coverString(value: number) {\r\n        if (value < 10)\r\n            return \"0\" + value;\r\n        return value.toString();\r\n    }\r\n\r\n    /** 设置时间能否由天数显示 */\r\n    setDateDisable(flag: boolean) {\r\n        this.dateDisable = flag;\r\n    }\r\n\r\n    /** 设置倒计时时间 */\r\n    setTime(second: number) {\r\n        this.countDown = second;                                             // 倒计时，初始化显示字符串\r\n        this.timing_end();\r\n        this.timing_start();\r\n    }\r\n\r\n    start() {\r\n        this.timing_start();\r\n    }\r\n\r\n    private onScheduleSecond() {\r\n        this.countDown--;\r\n        this.format();\r\n        if (this.onSecond) this.onSecond(this.node);\r\n\r\n        if (this.countDown == 0) {\r\n            this.onScheduleComplete();\r\n        }\r\n    }\r\n\r\n    private onScheduleComplete() {\r\n        this.timing_end();\r\n        if (this.onComplete) this.onComplete(this.node);\r\n    }\r\n\r\n    /** 开始计时 */\r\n    private timing_start() {\r\n        this.schedule(this.onScheduleSecond, 1);\r\n        this.format();\r\n    }\r\n\r\n    private timing_end() {\r\n        this.unscheduleAllCallbacks();\r\n        this.format();\r\n    }\r\n}\r\n"]}