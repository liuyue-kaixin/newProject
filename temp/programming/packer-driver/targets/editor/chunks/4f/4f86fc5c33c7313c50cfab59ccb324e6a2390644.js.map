{"version":3,"sources":["file:///Volumes/SSD%201/ccProject/assets/script/battle/demos/bulletHell/skill.ts"],"names":["_decorator","instantiate","Quat","Vec3","cObject","Trigger","ccclass","property","tempPos","tempRot","Skill","lifeTime","angle","get","prefab","skill","pools","pop","node","getComponent","put","push","remove","update","dt","pos","getPosition","velocity","x","y","z","fromEuler","setRotation","setPosition","onTrigger","b","trigger","exit"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,W,OAAAA,W;AAAqBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;;AAEvCC,MAAAA,O,iBAAAA,O;AAASC,MAAAA,O,iBAAAA,O;;;;;;;;;OACZ;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U;AAExBQ,MAAAA,O,GAAU,IAAIL,IAAJ,E;AACVM,MAAAA,O,GAAU,IAAIP,IAAJ,E;;uBAGHQ,K,WADZJ,OAAO,CAAC,OAAD,C,2BAAR,MACaI,KADb;AAAA;AAAA,8BACmC;AAAA;AAAA;AAoB/B;AApB+B,eAqB/BC,QArB+B,GAqBZ,CArBY;AAsB/B;AAtB+B,eAwB/BC,KAxB+B,GAwBhB,CAxBgB;AAAA;;AAIrB,eAAHC,GAAG,CAACC,MAAD,EAAiB;AACvB,cAAIC,KAAK,GAAG,KAAKC,KAAL,CAAWC,GAAX,MAAoB,IAAhC;;AACA,cAAI,CAACF,KAAL,EAAY;AACR,gBAAIG,IAAI,GAAGjB,WAAW,CAACa,MAAD,CAAtB;AACAC,YAAAA,KAAK,GAAGG,IAAI,CAACC,YAAL,CAAkBT,KAAlB,CAAR;AACH;;AACD,iBAAOK,KAAP;AACH;;AAES,eAAHK,GAAG,CAACL,KAAD,EAAe;AACrB;AACA,eAAKC,KAAL,CAAWK,IAAX,CAAgBN,KAAhB,EAFqB,CAGrB;;AACAA,UAAAA,KAAK,CAACO,MAAN,CAAa,KAAb;AACH;;AASDC,QAAAA,MAAM,CAACC,EAAD,EAAa;AAEf,eAAKb,QAAL,IAAiBa,EAAjB;;AACA,cAAI,KAAKb,QAAL,GAAgB,CAApB,EAAuB;AACnB;AACAD,YAAAA,KAAK,CAACU,GAAN,CAAU,IAAV;AACA;AACH,WAPc,CASf;;;AACA,cAAIK,GAAG,GAAG,KAAKC,WAAL,EAAV;AACA,cAAIC,QAAQ,GAAG,KAAKA,QAApB;AAEAnB,UAAAA,OAAO,CAACoB,CAAR,GAAYH,GAAG,CAACG,CAAJ,GAAQD,QAAQ,CAACC,CAAT,GAAaJ,EAAjC;AACAhB,UAAAA,OAAO,CAACqB,CAAR,GAAYJ,GAAG,CAACI,CAAJ,GAAQF,QAAQ,CAACE,CAAT,GAAaL,EAAjC;AACAhB,UAAAA,OAAO,CAACsB,CAAR,GAAYL,GAAG,CAACK,CAAJ,GAAQH,QAAQ,CAACG,CAAT,GAAaN,EAAjC;AAGA,eAAKZ,KAAL,IAAcY,EAAE,GAAG,EAAL,GAAU,EAAxB;AACAtB,UAAAA,IAAI,CAAC6B,SAAL,CAAetB,OAAf,EAAwB,CAAxB,EAA2B,CAA3B,EAA8B,KAAKG,KAAnC;AACA,eAAKoB,WAAL,CAAiBvB,OAAjB,EApBe,CAoBW;;AAE1B,eAAKwB,WAAL,CAAiBzB,OAAjB;AAEH;;AAGD0B,QAAAA,SAAS,CAACC,CAAD,EAAUC,OAAV,EAA4B;AACjC,cAAGA,OAAO,IAAI;AAAA;AAAA,kCAAQC,IAAtB,EAA6B,OADI,CAEjC;AACA;AACA;AACA;AACH;;AA5D8B,O,UAGxBrB,K,GAAsB,E","sourcesContent":["import { _decorator, instantiate, Prefab, Quat, Vec3 } from 'cc';\nimport { cBody } from '../../collision/Body';\nimport { cObject, Trigger } from '../../collision/Object';\nconst { ccclass, property } = _decorator;\n\nconst tempPos = new Vec3();\nconst tempRot = new Quat();\n\n@ccclass('Skill')\nexport class Skill extends cObject {\n\n    //缓存池管理\n    static pools: Array<Skill> = [];\n    static get(prefab: Prefab) {\n        let skill = this.pools.pop() || null;\n        if (!skill) {\n            let node = instantiate(prefab);\n            skill = node.getComponent(Skill);\n        }\n        return skill;\n    }\n\n    static put(skill: Skill) {\n        //压入缓存池管理节点\n        this.pools.push(skill);\n        //移除node不回收body\n        skill.remove(false);\n    }\n\n    //生命周期，回收时间\n    lifeTime: number = 0;\n    //attack: number = 0;\n\n    angle:number = 0;\n\n\n    update(dt: number) {\n\n        this.lifeTime -= dt;\n        if (this.lifeTime < 0) {\n            //生命周期回收\n            Skill.put(this);\n            return;\n        }\n\n        //计算新位置\n        let pos = this.getPosition();\n        let velocity = this.velocity;\n\n        tempPos.x = pos.x + velocity.x * dt;\n        tempPos.y = pos.y + velocity.y * dt;\n        tempPos.z = pos.z + velocity.z * dt;\n\n\n        this.angle += dt * 60 * 60;\n        Quat.fromEuler(tempRot, 0, 0, this.angle);\n        this.setRotation(tempRot);//更新节点旋转\n\n        this.setPosition(tempPos);\n\n    }\n\n\n    onTrigger(b: cBody,trigger: Trigger) {\n        if(trigger == Trigger.exit ) return;\n        //击中回收子弹\n        //Skill.put(this);\n        //播放爆炸特效\n        //.........\n    }\n}\n\n"]}