{"version":3,"sources":["file:///Volumes/%E5%9B%BA%E6%80%81/ccProject/extensions/oops-plugin-framework/assets/core/gui/layer/LayerDialog.ts"],"names":["LayerDialog","ViewParams","LayerPopUp","params","current","add","config","callbacks","black","enabled","valid","uuid","getUuid","prefab","push","show","prefabPath","viewParams","ui_nodes","get","set","onRemove_Source","onRemoved","node","setTimeout","next","load","bundle","setBlackDisable","length","param","shift"],"mappings":"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","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2021-07-03 16:13:17\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2023-07-24 17:14:57\r\n */\r\n\r\nimport { Node } from \"cc\";\r\nimport { UICallbacks, ViewParams } from \"./Defines\";\r\nimport { UIConfig } from \"./LayerManager\";\r\nimport { LayerPopUp } from \"./LayerPopup\";\r\n\r\n/** 模式弹窗数据 */\r\ntype DialogParam = {\r\n    config: UIConfig;\r\n    params?: any;\r\n    callbacks?: UICallbacks;\r\n}\r\n\r\n/*\r\n * 模式弹窗层，该层的窗口同时只能显示一个，删除以后会自动从队列当中取一个弹窗，直到队列为空\r\n */\r\nexport class LayerDialog extends LayerPopUp {\r\n    /** 窗口调用参数队列 */\r\n    private params: Array<DialogParam> = [];\r\n    /** 当前窗口数据 */\r\n    private current!: ViewParams;\r\n\r\n    add(config: UIConfig, params?: any, callbacks?: UICallbacks): string {\r\n        this.black.enabled = true;\r\n\r\n        if (this.current && this.current.valid) {\r\n            let uuid = this.getUuid(config.prefab);\r\n            this.params.push({\r\n                config: config,\r\n                params: params,\r\n                callbacks: callbacks,\r\n            });\r\n            return uuid;\r\n        }\r\n        return this.show(config, params, callbacks);\r\n    }\r\n\r\n    private show(config: UIConfig, params?: any, callbacks?: UICallbacks): string {\r\n        let prefabPath = config.prefab\r\n        var uuid = this.getUuid(prefabPath);\r\n        var viewParams = this.ui_nodes.get(uuid);\r\n        if (viewParams == null) {\r\n            viewParams = new ViewParams();\r\n            viewParams.uuid = this.getUuid(prefabPath);\r\n            viewParams.prefabPath = prefabPath;\r\n            viewParams.valid = true;\r\n            this.ui_nodes.set(viewParams.uuid, viewParams);\r\n        }\r\n\r\n        viewParams.callbacks = callbacks ?? {};\r\n        var onRemove_Source = viewParams.callbacks.onRemoved;\r\n        viewParams.callbacks.onRemoved = (node: Node | null, params: any) => {\r\n            if (onRemove_Source) {\r\n                onRemove_Source(node, params);\r\n            }\r\n            setTimeout(() => {\r\n                this.next();\r\n            }, 0);\r\n        };\r\n\r\n        viewParams.params = params || {};\r\n        this.current = viewParams;\r\n        this.load(viewParams, config.bundle);\r\n\r\n        return uuid;\r\n    }\r\n\r\n    protected setBlackDisable() {\r\n        if (this.params.length == 0) this.black.enabled = false;\r\n    }\r\n\r\n    private next() {\r\n        if (this.params.length > 0) {\r\n            let param = this.params.shift()!;\r\n            this.show(param.config, param.params, param.callbacks);\r\n        }\r\n    }\r\n}"]}