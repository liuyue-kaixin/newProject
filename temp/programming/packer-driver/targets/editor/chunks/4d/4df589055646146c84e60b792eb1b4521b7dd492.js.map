{"version":3,"sources":["file:///Volumes/SSD/ccProject/assets/script/battle/demos/bulletHell/detector.ts"],"names":["Vec3","_decorator","Dirty","Trigger","cObject","Player","PhysicsGroup","ccclass","property","detector","GOODS","goods","ENEMY","enemy","start","body","group","mask","update","dt","isDirty","T","onTrigger","b","trigger","exit","cb","getCenter","ca","lengthSqr","squaredDistance","attackRaidus","inst","onAttack","collectRaidus","onCollect"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAwBA,MAAAA,I,OAAAA,I;AAAMC,MAAAA,U,OAAAA,U;;AAErBC,MAAAA,K,iBAAAA,K;AAAOC,MAAAA,O,iBAAAA,O;AAASC,MAAAA,O,iBAAAA,O;;AAChBC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,Y,iBAAAA,Y;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U,GAE9B;;0BAEaQ,Q,WADZF,OAAO,CAAC,UAAD,C,2BAAR,MACaE,QADb;AAAA;AAAA,8BACsC;AAAA;AAAA;;AAAA;;AAAA;;AAQlC;AARkC,eASlCC,KATkC,GAS1B;AAAA;AAAA,4CAAaC,KATa;AAAA,eAUlCC,KAVkC,GAU1B;AAAA;AAAA,4CAAaC,KAVa;AAAA;;AAYlCC,QAAAA,KAAK,GAAS;AACV;AACA,eAAKC,IAAL,CAAUC,KAAV,GAAkB,CAAlB,CAFU,CAEW;;AACrB,eAAKD,IAAL,CAAUE,IAAV,GAAiB,KAAKL,KAAL,GAAa,KAAKF,KAAnC;AACH;;AAEDQ,QAAAA,MAAM,CAACC,EAAD,EAAmB;AACrB;AACA,eAAKC,OAAL,IAAgB;AAAA;AAAA,8BAAMC,CAAtB;AACH;;AAEDC,QAAAA,SAAS,CAACC,CAAD,EAAUC,OAAV,EAA4B;AACjC,cAAGA,OAAO,IAAI;AAAA;AAAA,kCAAQC,IAAtB,EAA6B,OADI,CAGjC;;AACA,cAAIC,EAAE,GAAGH,CAAC,CAACI,SAAF,EAAT,CAJiC,CAIT;;AACxB,cAAIC,EAAE,GAAG,KAAKb,IAAL,CAAUY,SAAV,EAAT,CALiC,CAKD;;AAChC,cAAIE,SAAS,GAAG7B,IAAI,CAAC8B,eAAL,CAAqBF,EAArB,EAAyBF,EAAzB,CAAhB,CANiC,CAQjC;;AACA,cAAIG,SAAS,GAAG,KAAKE,YAAL,GAAoB,KAAKA,YAAzC,EAAuD;AACnD,gBAAIR,CAAC,CAACP,KAAF,IAAW,KAAKJ,KAApB,EAA2B;AACvB;AAAA;AAAA,oCAAOoB,IAAP,CAAYC,QAAZ,CAAqBV,CAArB;AACH;AACJ,WAbgC,CAejC;;;AACA,cAAIM,SAAS,GAAG,KAAKK,aAAL,GAAqB,KAAKA,aAA1C,EAAyD;AACrD,gBAAIX,CAAC,CAACP,KAAF,IAAW,KAAKN,KAApB,EAA2B;AACvB;AAAA;AAAA,oCAAOsB,IAAP,CAAYG,SAAZ,CAAsBZ,CAAtB;AACH;AACJ;AACJ;;AA5CiC,O,+EAEjCf,Q;;;;;iBACsB,C;;wFAEtBA,Q;;;;;iBACuB,C","sourcesContent":["import { PhysicsSystem, Vec3, _decorator } from 'cc';\nimport { cBody } from '../../collision/Body';\nimport { Dirty, Trigger, cObject } from '../../collision/Object';\nimport { Player } from './player';\nimport { PhysicsGroup } from '../../../game/common/config/ConstDefine';\nconst { ccclass, property } = _decorator;\n\n//Payer 探测触发器\n@ccclass('detector')\nexport class detector extends cObject {\n\n    @property//攻击半径\n    attackRaidus: number = 0;\n\n    @property  //收集半径\n    collectRaidus: number = 0;\n\n    //获取默认物理控制面板的分组信息\n    GOODS = PhysicsGroup.goods;\n    ENEMY = PhysicsGroup.enemy;\n\n    start(): void {\n        //自定义设置掩码,收集范围内的敌人和物品\n        this.body.group = 0; //不接受任何掩码\n        this.body.mask = this.ENEMY | this.GOODS;\n    }\n\n    update(dt: number): void {\n        //需要实时，同步更新 player 位置\n        this.isDirty |= Dirty.T;\n    }\n\n    onTrigger(b: cBody,trigger: Trigger) {\n        if(trigger == Trigger.exit ) return;\n\n        //世界中心坐标\n        let cb = b.getCenter(); // b.getPosition()\n        let ca = this.body.getCenter(); // this.body.getPosition();\n        let lengthSqr = Vec3.squaredDistance(ca, cb);\n\n        //攻击半径\n        if (lengthSqr < this.attackRaidus * this.attackRaidus) {\n            if (b.group == this.ENEMY) {\n                Player.inst.onAttack(b);\n            }\n        }\n\n        //收集半径\n        if (lengthSqr < this.collectRaidus * this.collectRaidus) {\n            if (b.group == this.GOODS) {\n                Player.inst.onCollect(b);\n            }\n        }\n    }\n}\n\n"]}