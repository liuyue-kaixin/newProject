{"version":3,"sources":["file:///Volumes/SSD/ccProject/assets/script/game/initialize/bll/InitRes.ts"],"names":["oops","AsyncQueue","ecs","UIID","LoadingViewComp","InitResComp","register","Comp","reset","InitResSystem","ComblockSystem","filter","allOf","entityEnter","e","queue","onComplete","play","loadCustom","push","next","params","args","res","load","language","current","loadLanguage","lan","storage","get","set","pack","json","config","game","languagePathJson","texture","languagePathTexture","setLanguage","loadCommon","loadDir","complete","node","gui","openAsync","Loading","add","getComponent","remove"],"mappings":"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","sourcesContent":["/*\n * @Author: dgflash\n * @Date: 2022-07-22 17:06:22\n * @LastEditors: dgflash\n * @LastEditTime: 2022-09-22 14:41:58\n */\n\nimport { oops } from \"../../../../../extensions/oops-plugin-framework/assets/core/Oops\";\nimport { AsyncQueue, NextFunction } from \"../../../../../extensions/oops-plugin-framework/assets/libs/collection/AsyncQueue\";\nimport { ecs } from \"../../../../../extensions/oops-plugin-framework/assets/libs/ecs/ECS\";\nimport { UIID } from \"../../common/config/GameUIConfig\";\nimport { Initialize } from \"../Initialize\";\nimport { LoadingViewComp } from \"../view/LoadingViewComp\";\n\n/** 初始化游戏公共资源 */\n@ecs.register('InitRes')\nexport class InitResComp extends ecs.Comp {\n    reset() { }\n}\n\n@ecs.register('Initialize')\nexport class InitResSystem extends ecs.ComblockSystem implements ecs.IEntityEnterSystem {\n    filter(): ecs.IMatcher {\n        return ecs.allOf(InitResComp);\n    }\n\n    entityEnter(e: Initialize): void {\n        var queue: AsyncQueue = new AsyncQueue();\n\n        // 加载自定义资源\n        // this.loadCustom(queue);\n        // 加载多语言包\n        // this.loadLanguage(queue);\n        // 加载公共资源\n        // this.loadCommon(queue);\n        // 加载游戏内容加载进度提示界面\n        this.onComplete(queue, e);\n\n        queue.play();\n    }\n\n    /** 加载自定义内容（可选） */\n    private loadCustom(queue: AsyncQueue) {\n        queue.push(async (next: NextFunction, params: any, args: any) => {\n            // 加载多语言对应字体\n            oops.res.load(\"language/font/\" + oops.language.current, next);\n        });\n    }\n\n    /** 加载化语言包（可选） */\n    private loadLanguage(queue: AsyncQueue) {\n        queue.push((next: NextFunction, params: any, args: any) => {\n            // 设置默认语言\n            let lan = oops.storage.get(\"language\");\n            // if (lan == null) {\n            if (lan == null || lan == \"\") {\n                lan = \"zh\";\n                oops.storage.set(\"language\", lan);\n            }\n\n            // 设置语言包路径\n            oops.language.pack.json = oops.config.game.languagePathJson;\n            oops.language.pack.texture = oops.config.game.languagePathTexture;\n\n            // 加载语言包资源\n            oops.language.setLanguage(lan, next);\n        });\n    }\n\n    /** 加载公共资源（必备） */\n    private loadCommon(queue: AsyncQueue) {\n        queue.push((next: NextFunction, params: any, args: any) => {\n            oops.res.loadDir(\"common\", next);\n        });\n    }\n\n    /** 加载完成进入游戏内容加载界面 */\n    private onComplete(queue: AsyncQueue, e: Initialize) {\n        queue.complete = async () => {\n            var node = await oops.gui.openAsync(UIID.Loading);\n            if (node) e.add(node.getComponent(LoadingViewComp) as ecs.Comp);\n            e.remove(InitResComp);\n        };\n    }\n}"]}