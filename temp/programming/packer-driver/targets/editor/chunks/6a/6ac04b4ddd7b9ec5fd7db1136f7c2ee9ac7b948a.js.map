{"version":3,"sources":["file:///Volumes/SSD/ccProject/extensions/oops-plugin-framework/assets/libs/gui/button/ButtonTouchLong.ts"],"names":["EventHandler","_decorator","ButtonEffect","ccclass","property","menu","ButtonTouchLong","tooltip","type","_passTime","_isTouchLong","_event","onLoad","onTouchtStart","event","onTouchEnd","time","propagationStopped","removeTouchLong","update","dt","clickEvents","forEach","emit","customEventData"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAMSA,MAAAA,Y,OAAAA,Y;AAA0BC,MAAAA,U,OAAAA,U;;AAC5BC,MAAAA,Y;;;;;;AAPP;AACA;AACA;AACA;AACA;AACA;;;;;OAIM;AAAEC,QAAAA,OAAF;AAAWC,QAAAA,QAAX;AAAqBC,QAAAA;AAArB,O,GAA8BJ,U;;iCAIvBK,e,WAFZH,OAAO,CAAC,iBAAD,C,UACPE,IAAI,CAAC,2BAAD,C,UAEAD,QAAQ,CAAC;AACNG,QAAAA,OAAO,EAAE;AADH,OAAD,C,UAKRH,QAAQ,CAAC;AACNI,QAAAA,IAAI,EAAE,CAACR,YAAD,CADA;AAENO,QAAAA,OAAO,EAAE;AAFH,OAAD,C,0CARb,MAEaD,eAFb;AAAA;AAAA,wCAEkD;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eAYpCG,SAZoC,GAYxB,CAZwB;AAAA,eAapCC,YAboC,GAaZ,IAbY;AAAA,eAcpCC,MAdoC,GAcR,IAdQ;AAAA;;AAgB9CC,QAAAA,MAAM,GAAG;AACL,eAAKF,YAAL,GAAoB,KAApB;AACA,gBAAME,MAAN;AACH;AAED;;;AACAC,QAAAA,aAAa,CAACC,KAAD,EAAoB;AAC7B,eAAKH,MAAL,GAAcG,KAAd;AACA,eAAKL,SAAL,GAAiB,CAAjB;AACA,gBAAMI,aAAN,CAAoBC,KAApB;AACH;AAED;;;AACAC,QAAAA,UAAU,CAACD,KAAD,EAAoB;AAC1B,cAAI,KAAKL,SAAL,GAAiB,KAAKO,IAA1B,EAAgC;AAC5BF,YAAAA,KAAK,CAACG,kBAAN,GAA2B,IAA3B;AACH;;AACD,eAAKN,MAAL,GAAc,IAAd;AACA,eAAKF,SAAL,GAAiB,CAAjB;AACA,eAAKC,YAAL,GAAoB,KAApB;AAEA,gBAAMK,UAAN,CAAiBD,KAAjB;AACH;;AAEDI,QAAAA,eAAe,GAAG;AACd,eAAKP,MAAL,GAAc,IAAd;AACA,eAAKD,YAAL,GAAoB,KAApB;AACH;AAED;;;AACAS,QAAAA,MAAM,CAACC,EAAD,EAAa;AACf,cAAI,KAAKT,MAAL,IAAe,CAAC,KAAKD,YAAzB,EAAuC;AACnC,iBAAKD,SAAL,IAAkBW,EAAlB;;AAEA,gBAAI,KAAKX,SAAL,IAAkB,KAAKO,IAA3B,EAAiC;AAC7B,mBAAKN,YAAL,GAAoB,IAApB;AACA,mBAAKW,WAAL,CAAiBC,OAAjB,CAAyBR,KAAK,IAAI;AAC9BA,gBAAAA,KAAK,CAACS,IAAN,CAAW,CAACT,KAAK,CAACU,eAAP,CAAX;AACH,eAFD;AAGA,mBAAKN,eAAL;AACH;AACJ;AACJ;;AA1D6C,O;;;;;iBAI/B,C;;;;;;;iBAMe,E","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2022-04-14 17:08:01\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2022-04-14 18:15:42\r\n */\r\nimport { EventHandler, EventTouch, _decorator } from \"cc\";\r\nimport ButtonEffect from \"./ButtonEffect\";\r\n\r\nconst { ccclass, property, menu } = _decorator;\r\n\r\n@ccclass(\"ButtonTouchLong\")\r\n@menu('ui/button/ButtonTouchLong')\r\nexport class ButtonTouchLong extends ButtonEffect {\r\n    @property({\r\n        tooltip: \"长按时间（秒）\"\r\n    })\r\n    time: number = 1;\r\n\r\n    @property({\r\n        type: [EventHandler],\r\n        tooltip: \"长按时间（秒）\"\r\n    })\r\n    clickEvents: EventHandler[] = [];\r\n\r\n    protected _passTime = 0;\r\n    protected _isTouchLong: boolean = true;\r\n    protected _event: EventTouch | null = null;\r\n\r\n    onLoad() {\r\n        this._isTouchLong = false;\r\n        super.onLoad();\r\n    }\r\n\r\n    /** 触摸开始 */\r\n    onTouchtStart(event: EventTouch) {\r\n        this._event = event;\r\n        this._passTime = 0;\r\n        super.onTouchtStart(event);\r\n    }\r\n\r\n    /** 触摸结束 */\r\n    onTouchEnd(event: EventTouch) {\r\n        if (this._passTime > this.time) {\r\n            event.propagationStopped = true;\r\n        }\r\n        this._event = null;\r\n        this._passTime = 0;\r\n        this._isTouchLong = false;\r\n\r\n        super.onTouchEnd(event);\r\n    }\r\n\r\n    removeTouchLong() {\r\n        this._event = null;\r\n        this._isTouchLong = false;\r\n    }\r\n\r\n    /** 引擎更新事件 */\r\n    update(dt: number) {\r\n        if (this._event && !this._isTouchLong) {\r\n            this._passTime += dt;\r\n\r\n            if (this._passTime >= this.time) {\r\n                this._isTouchLong = true;\r\n                this.clickEvents.forEach(event => {\r\n                    event.emit([event.customEventData])\r\n                });\r\n                this.removeTouchLong();\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}