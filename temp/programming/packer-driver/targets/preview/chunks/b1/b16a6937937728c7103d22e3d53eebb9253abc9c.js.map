{"version":3,"sources":["file:///Volumes/SSD%201/ccProject/extensions/oops-plugin-framework/assets/libs/model-view/VMProgress.ts"],"names":["CCString","_decorator","StringFormatFunction","VMCustom","VMEnv","ccclass","property","menu","help","VMProgress","visible","override","type","tooltip","componentProperty","templateMode","onLoad","watchPathArr","length","console","error","start","editor","onValueInit","max","i","templateValueArr","VM","getValue","value","setComponentValue","stringFormat","res","deal","onValueController","n","o","Math","round","Number","isNaN","setValue","onValueChanged","pathArr","path","join","index","findIndex","v"],"mappings":"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","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2022-08-11 14:45:44\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2022-08-11 15:43:34\r\n */\r\nimport { CCString, _decorator } from \"cc\";\r\nimport { StringFormatFunction } from \"./StringFormat\";\r\nimport { VMCustom } from \"./VMCustom\";\r\nimport { VMEnv } from \"./VMEnv\";\r\n\r\nconst { ccclass, property, menu, help } = _decorator;\r\n\r\n@ccclass\r\n@menu('ModelViewer/VM-Progress (VM-进度条)')\r\n@help('https://gitee.com/dgflash/oops-framework/blob/master/doc/mvvm/VMProgress.md')\r\nexport default class VMProgress extends VMCustom {\r\n    @property({\r\n        visible: false,\r\n        override: true\r\n    })\r\n    watchPath: string = '';\r\n\r\n    @property({\r\n        type: [CCString],\r\n        tooltip: '第一个值是min 值，第二个值 是 max 值，会计算出两者的比例'\r\n    })\r\n    protected watchPathArr: string[] = ['[min]', '[max]'];\r\n\r\n    public templateMode: boolean = true;\r\n\r\n    @property({\r\n        visible: function () {\r\n            // @ts-ignore\r\n            return this.componentProperty === 'string';\r\n        },\r\n        tooltip: '字符串格式化，和 VMLabel 的字段一样，需要填入对应的格式化字符串'\r\n    })\r\n    stringFormat: string = '';\r\n\r\n    onLoad() {\r\n        if (this.watchPathArr.length < 2 || this.watchPathArr[0] == '[min]' || this.watchPathArr[1] == '[max]') {\r\n            console.error('VMProgress must have two values!');\r\n        }\r\n        super.onLoad();\r\n    }\r\n\r\n    start() {\r\n        if (VMEnv.editor) return;\r\n\r\n        this.onValueInit();\r\n    }\r\n\r\n    onValueInit() {\r\n        let max = this.watchPathArr.length;\r\n        for (let i = 0; i < max; i++) {\r\n            this.templateValueArr[i] = this.VM.getValue(this.watchPathArr[i]);\r\n        }\r\n\r\n        let value = this.templateValueArr[0] / this.templateValueArr[1];\r\n        this.setComponentValue(value);\r\n    }\r\n\r\n    setComponentValue(value: any) {\r\n        if (this.stringFormat !== '') {\r\n            let res = StringFormatFunction.deal(value, this.stringFormat);\r\n            super.setComponentValue(res);\r\n        }\r\n        else {\r\n            super.setComponentValue(value);\r\n        }\r\n    }\r\n\r\n    onValueController(n: any, o: any) {\r\n        let value = Math.round(n * this.templateValueArr[1]);\r\n        if (Number.isNaN(value)) value = 0;\r\n        this.VM.setValue(this.watchPathArr[0], value);\r\n    }\r\n\r\n    /** 初始化改变数据 */\r\n    onValueChanged(n: any, o: any, pathArr: string[]) {\r\n        if (this.templateMode === false) return;\r\n\r\n        let path = pathArr.join('.');\r\n        // 寻找缓存位置\r\n        let index = this.watchPathArr.findIndex(v => v === path);\r\n        if (index >= 0) {\r\n            // 如果是所属的路径，就可以替换文本了\r\n            this.templateValueArr[index] = n; //缓存值\r\n        }\r\n\r\n        let value = this.templateValueArr[0] / this.templateValueArr[1];\r\n        if (value > 1) value = 1;\r\n        if (value < 0 || Number.isNaN(value)) value = 0;\r\n\r\n        this.setComponentValue(value);\r\n    }\r\n}\r\n"]}