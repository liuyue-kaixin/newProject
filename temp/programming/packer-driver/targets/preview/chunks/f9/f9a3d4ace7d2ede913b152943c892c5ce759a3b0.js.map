{"version":3,"sources":["file:///Volumes/SSD%201/ccProject/extensions/oops-plugin-framework/assets/libs/animator-effect/2d/FlashSpine.ts"],"names":["Component","Material","sp","_decorator","ccclass","property","FlashSpine","duration","_median","_time","_material","_skeleton","onLoad","node","getComponent","Skeleton","customMaterial","setProperty","update","dt","rate","Math","abs","mat","copy","clickFlash"],"mappings":";;;;;;;;;;AAASA,MAAAA,S,OAAAA,S;AAAWC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,E,OAAAA,E;AAAIC,MAAAA,U,OAAAA,U;;;;;;;;;OAC5B;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBF,U;;yBAGTG,U,WADpBF,OAAO,CAAC,YAAD,C,gBAAR,MACqBE,UADrB,SACwCN,SADxC,CACkD;AAAA;AAAA;AAAA,eAC9CO,QAD8C,GAC3B,GAD2B;AAAA,eAE9CC,OAF8C,GAE5B,CAF4B;AAAA,eAG9CC,KAH8C,GAG9B,CAH8B;AAAA,eAK9CC,SAL8C,GAKxB,IALwB;AAAA,eAM9CC,SAN8C,GAMrB,IANqB;AAAA;;AAQ9CC,QAAAA,MAAM,GAAG;AACL,eAAKJ,OAAL,GAAe,KAAKD,QAAL,GAAgB,CAA/B,CADK,CAEL;;AACA,eAAKI,SAAL,GAAiB,KAAKE,IAAL,CAAUC,YAAV,CAAuBZ,EAAE,CAACa,QAA1B,CAAjB;AACA,eAAKL,SAAL,GAAiB,KAAKC,SAAL,CAAeK,cAAhC,CAJK,CAKL;;AACA,eAAKN,SAAL,CAAeO,WAAf,CAA2B,QAA3B,EAAqC,CAArC;AACH;;AAEDC,QAAAA,MAAM,CAACC,EAAD,EAAa;AACf,cAAI,KAAKV,KAAL,GAAa,CAAjB,EAAoB;AAChB,iBAAKA,KAAL,IAAcU,EAAd;AAEA,iBAAKV,KAAL,GAAa,KAAKA,KAAL,GAAa,CAAb,GAAiB,CAAjB,GAAqB,KAAKA,KAAvC;AACA,gBAAIW,IAAI,GAAGC,IAAI,CAACC,GAAL,CAAS,KAAKb,KAAL,GAAa,KAAKD,OAA3B,IAAsC,CAAtC,GAA0C,KAAKD,QAA1D;AAEA,gBAAIgB,GAAG,GAAG,IAAItB,QAAJ,EAAV;AACAsB,YAAAA,GAAG,CAACC,IAAJ,CAAS,KAAKd,SAAd;AACA,iBAAKC,SAAL,CAAeK,cAAf,GAAgCO,GAAhC;AACAA,YAAAA,GAAG,CAACN,WAAJ,CAAgB,QAAhB,EAA0BG,IAA1B;AACH;AACJ;;AAEDK,QAAAA,UAAU,GAAG;AACT,eAAKhB,KAAL,GAAa,KAAKF,QAAlB;AACH;;AAjC6C,O","sourcesContent":["import { Component, Material, sp, _decorator } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('FlashSpine')\r\nexport default class FlashSpine extends Component {\r\n    duration: number = 0.5;\r\n    _median: number = 0;\r\n    _time: number = 0;\r\n\r\n    _material: Material = null!;\r\n    _skeleton: sp.Skeleton = null!;\r\n\r\n    onLoad() {\r\n        this._median = this.duration / 2;\r\n        // 获取材质\r\n        this._skeleton = this.node.getComponent(sp.Skeleton)!;\r\n        this._material = this._skeleton.customMaterial!;\r\n        // 设置材质对应的属性\r\n        this._material.setProperty(\"u_rate\", 1);\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (this._time > 0) {\r\n            this._time -= dt;\r\n\r\n            this._time = this._time < 0 ? 0 : this._time;\r\n            let rate = Math.abs(this._time - this._median) * 2 / this.duration;\r\n\r\n            let mat = new Material();\r\n            mat.copy(this._material);\r\n            this._skeleton.customMaterial = mat;\r\n            mat.setProperty(\"u_rate\", rate);\r\n        }\r\n    }\r\n    \r\n    clickFlash() {\r\n        this._time = this.duration;\r\n    }\r\n}\r\n"]}