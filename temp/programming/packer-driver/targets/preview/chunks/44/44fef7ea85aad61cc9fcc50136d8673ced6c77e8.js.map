{"version":3,"sources":["file:///Volumes/SSD%201/ccProject/extensions/oops-plugin-framework/assets/libs/animator/AnimatorSkeletal.ts"],"names":["CCFloat","game","SkeletalAnimation","_decorator","AnimatorAnimation","ccclass","property","requireComponent","disallowMultiple","menu","AnimatorSkeletal","type","tooltip","cross_duration","current_time","onLoad","duration","playAnimation","animName","loop","totalTime","_animation","crossFade","play","_animState","getState","_wrapModeMap","has","set","wrapMode"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAOSA,MAAAA,O,OAAAA,O;AAASC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,iB,OAAAA,iB;AAAmBC,MAAAA,U,OAAAA,U;;AACpCC,MAAAA,iB;;;;;;AARP;AACA;AACA;AACA;AACA;AACA;;;;;OAKM;AAAEC,QAAAA,OAAF;AAAWC,QAAAA,QAAX;AAAqBC,QAAAA,gBAArB;AAAuCC,QAAAA,gBAAvC;AAAyDC,QAAAA;AAAzD,O,GAAkEN,U;;kCAM3DO,gB,WAFZH,gBAAgB,CAACL,iBAAD,C,UAChBO,IAAI,CAAC,2BAAD,C,UAEAH,QAAQ,CAAC;AACNK,QAAAA,IAAI,EAAEX,OADA;AAENY,QAAAA,OAAO,EAAE;AAFH,OAAD,C,EALZP,O,UACAG,gB,kDADD,MAIaE,gBAJb;AAAA;AAAA,kDAIwD;AAAA;AAAA;;AAAA;;AAAA,eAO5CG,cAP4C,GAOnB,CAPmB;AAOR;AAPQ,eAQ5CC,YAR4C,GAQrB,CARqB;AAAA;;AAQR;AAE5CC,QAAAA,MAAM,GAAG;AACL,eAAKF,cAAL,GAAsB,KAAKG,QAAL,GAAgB,IAAtC;AACH;AAED;AACJ;AACA;AACA;AACA;AACA;;;AACcC,QAAAA,aAAa,CAACC,QAAD,EAAmBC,IAAnB,EAAkC;AACrD,cAAI,CAACD,QAAL,EAAe;AACX;AACH;;AAED,cAAIjB,IAAI,CAACmB,SAAL,GAAiB,KAAKN,YAAtB,GAAqC,KAAKD,cAA9C,EAA8D;AAC1D,iBAAKQ,UAAL,CAAgBC,SAAhB,CAA0BJ,QAA1B,EAAoC,KAAKF,QAAzC;AACH,WAFD,MAGK;AACD,iBAAKK,UAAL,CAAgBE,IAAhB,CAAqBL,QAArB;AACH;;AACD,eAAKJ,YAAL,GAAoBb,IAAI,CAACmB,SAAzB;AAEA,eAAKI,UAAL,GAAkB,KAAKH,UAAL,CAAgBI,QAAhB,CAAyBP,QAAzB,CAAlB;;AACA,cAAI,CAAC,KAAKM,UAAV,EAAsB;AAClB;AACH;;AACD,cAAI,CAAC,KAAKE,YAAL,CAAkBC,GAAlB,CAAsB,KAAKH,UAA3B,CAAL,EAA6C;AACzC,iBAAKE,YAAL,CAAkBE,GAAlB,CAAsB,KAAKJ,UAA3B,EAAuC,KAAKA,UAAL,CAAgBK,QAAvD;AACH,WAnBoD,CAoBrD;;;AACA,eAAKL,UAAL,CAAgBK,QAAhB,GAA2BV,IAAI,GAAG,CAAH,GAAO,CAAtC,CArBqD,CAqBV;AAC9C;;AA1CmD,O;;;;;iBAKzB,G","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2021-06-30 13:56:26\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2021-11-04 10:46:00\r\n */\r\n\r\nimport { CCFloat, game, SkeletalAnimation, _decorator } from 'cc';\r\nimport AnimatorAnimation from './AnimatorAnimation';\r\n\r\nconst { ccclass, property, requireComponent, disallowMultiple, menu } = _decorator;\r\n\r\n@ccclass\r\n@disallowMultiple\r\n@requireComponent(SkeletalAnimation)\r\n@menu('animator/AnimatorSkeletal')\r\nexport class AnimatorSkeletal extends AnimatorAnimation {\r\n    @property({\r\n        type: CCFloat,\r\n        tooltip: \"动画切换过度时间\"\r\n    })\r\n    private duration: number = 0.3;\r\n\r\n    private cross_duration: number = 0;         // 防止切换动画时间少于间隔时间导致动画状态错乱的问题\r\n    private current_time: number = 0;           // 上一次切换状态时间\r\n\r\n    onLoad() {\r\n        this.cross_duration = this.duration * 1000;\r\n    }\r\n\r\n    /**\r\n      * 播放动画\r\n      * @override\r\n      * @param animName 动画名\r\n      * @param loop 是否循环播放\r\n      */\r\n    protected playAnimation(animName: string, loop: boolean) {\r\n        if (!animName) {\r\n            return;\r\n        }\r\n\r\n        if (game.totalTime - this.current_time > this.cross_duration) {\r\n            this._animation.crossFade(animName, this.duration);\r\n        }\r\n        else {\r\n            this._animation.play(animName);\r\n        }\r\n        this.current_time = game.totalTime;\r\n\r\n        this._animState = this._animation.getState(animName);\r\n        if (!this._animState) {\r\n            return;\r\n        }\r\n        if (!this._wrapModeMap.has(this._animState)) {\r\n            this._wrapModeMap.set(this._animState, this._animState.wrapMode);\r\n        }\r\n        // this._animState.wrapMode = loop ? 2 : this._wrapModeMap.get(this._animState)!;\r\n        this._animState.wrapMode = loop ? 2 : 1;   // 2为循环播放，1为单次播放\r\n    }\r\n}\r\n"]}