{"version":3,"sources":["file:///Volumes/%E5%9B%BA%E6%80%81/ccProject/assets/bundle/battle/demos/bulletHell/player.ts"],"names":["Input","Prefab","Quat","Vec3","_decorator","Trigger","cObject","BulletHell","Gun","Skill","ccclass","property","tempPos","tempRot","Player","guns","velocity","inst","_inst","onLoad","start","node","getComponentsInChildren","joystick","init","event","angle","ratio","type","EventType","TOUCH_START","set","ZERO","TOUCH_MOVE","Math","cos","sin","multiplyScalar","maxVelocity","TOUCH_END","update","dt","pos","getPosition","x","y","z","setPosition","onAttack","b","length","i","postion","getCenter","shoot","onSkill","random","PI","parent","bullets","skill","get","insert","subtract","worldPosition","speed","lifeTime","onCollect","onTrigger","trigger","exit"],"mappings":"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","sourcesContent":["import { Input, Prefab, Quat, Vec3, _decorator } from 'cc';\nimport { cBody } from '../../collision/Body';\nimport { Trigger, cObject } from '../../collision/Object';\nimport { BulletHell } from './bulletHell';\nimport { Gun } from './gun';\nimport { Skill } from './skill';\nconst { ccclass, property } = _decorator;\n\nconst tempPos = new Vec3();\nconst tempRot = new Quat();\n\n@ccclass('Player')\nexport class Player extends cObject {\n\n    private static _inst: Player = null;\n    static get inst() {\n        return this._inst;\n    }\n\n\n    @property(Prefab)\n    skill:Prefab = null;\n\n    guns: Array<Gun> = [];\n    velocity: Vec3 = new Vec3();\n\n    onLoad(): void {\n        super.onLoad();\n        Player._inst = this;\n    }\n\n    start(): void {\n\n        //获取当前枪枝\n        this.guns = this.node.getComponentsInChildren(Gun);\n\n        //绑定摇杆回调\n        const joystick = BulletHell.inst.joystick;\n        if (joystick) {\n\n            joystick.init((event) => {\n\n                let angle = event.angle;\n                let ratio = event.ratio;\n                switch (event.type) {\n                    case Input.EventType.TOUCH_START:\n                        this.velocity.set(Vec3.ZERO);\n                        break;\n                    case Input.EventType.TOUCH_MOVE:\n                        this.velocity.set(Math.cos(angle), Math.sin(angle), 0);\n                        this.velocity.multiplyScalar(this.maxVelocity * ratio);\n                        break;\n                    case Input.EventType.TOUCH_END:\n                        this.velocity.set(Vec3.ZERO);\n                        break;\n                }\n            });\n        }\n\n    }\n\n    update(dt: number): void {\n\n        //计算新位置\n        let pos = this.getPosition();\n        let velocity = this.velocity;\n\n        tempPos.x = pos.x + velocity.x * dt;\n        tempPos.y = pos.y + velocity.y * dt;\n        tempPos.z = pos.z + velocity.z * dt;\n\n        this.setPosition(tempPos);\n    }\n\n    onAttack(b: cBody) {\n        //进入攻击范围\n        let guns = this.guns;\n        let length = guns.length;\n\n        for (let i = 0; i < length; i++) {\n            let postion = b.getCenter();\n            guns[i].shoot(postion);\n        }\n    }\n\n    onSkill(){\n\n        let angle = Math.random()*Math.PI*2;\n\n        for(let i = 0;i < 3;i++){\n\n            let parent = BulletHell.inst.bullets;\n            let skill = Skill.get(this.skill);\n            skill.insert(parent); \n            skill.init();\n    \n            Vec3.subtract(tempPos, this.node.worldPosition, parent.worldPosition);\n            skill.setPosition(tempPos);\n    \n            //发射速度和生命时长\n            let speed = 300;\n            angle+=Math.PI*2/3;\n            let x = Math.cos(angle),y = Math.sin(angle);\n            skill.velocity.set(x,y,0).multiplyScalar(speed);\n    \n            skill.angle = 0;\n            skill.lifeTime = 3;\n        }\n\n    }\n\n    onCollect(b: cBody) {\n        //进入拾取范围\n    }\n\n    onTrigger(b: cBody,trigger: Trigger) {\n        if(trigger == Trigger.exit ) return;\n        //碰撞到敌方\n        //自行扣血或者死亡\n    }\n}\n\n"]}