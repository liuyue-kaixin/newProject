{"version":3,"sources":["file:///Volumes/SSD%201/ccProject/extensions/oops-plugin-framework/assets/core/utils/JsonUtil.ts"],"names":["JsonUtil","JsonAsset","oops","path","data","Map","get","name","has","load","callback","url","res","err","content","console","warn","message","set","json","loadAsync","Promise","resolve","reject","release","delete"],"mappings":";;;gGAiBaA,Q;;;;;;;;;;;;;;;AAVJC,MAAAA,S,OAAAA,S;;AACAC,MAAAA,I,iBAAAA,I;;;;;;AART;AACA;AACA;AACA;AACA;AACA;;;;;AAKA;AACIC,MAAAA,I,GAAe,c;AAEnB;;AACIC,MAAAA,I,GAAyB,IAAIC,GAAJ,E;AAE7B;;0BACaL,Q,GAAN,MAAMA,QAAN,CAAe;AAClB;AACJ;AACA;AACA;AACc,eAAHM,GAAG,CAACC,IAAD,EAAoB;AAC1B,cAAIH,IAAI,CAACI,GAAL,CAASD,IAAT,CAAJ,EACI,OAAOH,IAAI,CAACE,GAAL,CAASC,IAAT,CAAP;AACP;AAED;AACJ;AACA;AACA;AACA;;;AACe,eAAJE,IAAI,CAACF,IAAD,EAAeG,QAAf,EAAyC;AAChD,cAAIN,IAAI,CAACI,GAAL,CAASD,IAAT,CAAJ,EACIG,QAAQ,CAACN,IAAI,CAACE,GAAL,CAASC,IAAT,CAAD,CAAR,CADJ,KAEK;AACD,gBAAII,GAAG,GAAGR,IAAI,GAAGI,IAAjB;AACA;AAAA;AAAA,8BAAKK,GAAL,CAASH,IAAT,CAAcE,GAAd,EAAmBV,SAAnB,EAA8B,CAACY,GAAD,EAAoBC,OAApB,KAA2C;AACrE,kBAAID,GAAJ,EAAS;AACLE,gBAAAA,OAAO,CAACC,IAAR,CAAaH,GAAG,CAACI,OAAjB;AACAP,gBAAAA,QAAQ,CAAC,IAAD,CAAR;AACH,eAHD,MAIK;AACDN,gBAAAA,IAAI,CAACc,GAAL,CAASX,IAAT,EAAeO,OAAO,CAACK,IAAvB;AACAT,gBAAAA,QAAQ,CAACI,OAAO,CAACK,IAAT,CAAR;AACH;AACJ,aATD;AAUH;AACJ;AAED;AACJ;AACA;AACA;;;AACoB,eAATC,SAAS,CAACb,IAAD,EAAe;AAC3B,iBAAO,IAAIc,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,gBAAInB,IAAI,CAACI,GAAL,CAASD,IAAT,CAAJ,EAAoB;AAChBe,cAAAA,OAAO,CAAClB,IAAI,CAACE,GAAL,CAASC,IAAT,CAAD,CAAP;AACH,aAFD,MAGK;AACD,kBAAII,GAAG,GAAGR,IAAI,GAAGI,IAAjB;AACA;AAAA;AAAA,gCAAKK,GAAL,CAASH,IAAT,CAAcE,GAAd,EAAmBV,SAAnB,EAA8B,CAACY,GAAD,EAAoBC,OAApB,KAA2C;AACrE,oBAAID,GAAJ,EAAS;AACLE,kBAAAA,OAAO,CAACC,IAAR,CAAaH,GAAG,CAACI,OAAjB;AACAK,kBAAAA,OAAO,CAAC,IAAD,CAAP;AACH,iBAHD,MAIK;AACDlB,kBAAAA,IAAI,CAACc,GAAL,CAASX,IAAT,EAAeO,OAAO,CAACK,IAAvB;AACAG,kBAAAA,OAAO,CAACR,OAAO,CAACK,IAAT,CAAP;AACH;AACJ,eATD;AAUH;AACJ,WAjBM,CAAP;AAkBH;AAED;AACJ;AACA;AACA;;;AACkB,eAAPK,OAAO,CAACjB,IAAD,EAAe;AACzB,cAAII,GAAG,GAAGR,IAAI,GAAGI,IAAjB;AACAH,UAAAA,IAAI,CAACqB,MAAL,CAAYlB,IAAZ;AACA;AAAA;AAAA,4BAAKK,GAAL,CAASY,OAAT,CAAiBb,GAAjB;AACH;;AAlEiB,O","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2021-08-18 17:00:59\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2023-08-22 15:48:02\r\n */\r\n\r\nimport { JsonAsset } from \"cc\";\r\nimport { oops } from \"../Oops\";\r\n\r\n/** 资源路径 */\r\nvar path: string = \"config/game/\";\r\n\r\n/** 数据缓存 */\r\nvar data: Map<string, any> = new Map();\r\n\r\n/** JSON数据表工具 */\r\nexport class JsonUtil {\r\n    /**\r\n     * 通知资源名从缓存中获取一个Json数据表\r\n     * @param name  资源名\r\n     */\r\n    static get(name: string): any {\r\n        if (data.has(name))\r\n            return data.get(name);\r\n    }\r\n\r\n    /**\r\n     * 通知资源名加载Json数据表\r\n     * @param name      资源名\r\n     * @param callback  资源加载完成回调\r\n     */\r\n    static load(name: string, callback: Function): void {\r\n        if (data.has(name))\r\n            callback(data.get(name));\r\n        else {\r\n            var url = path + name;\r\n            oops.res.load(url, JsonAsset, (err: Error | null, content: JsonAsset) => {\r\n                if (err) {\r\n                    console.warn(err.message);\r\n                    callback(null);\r\n                }\r\n                else {\r\n                    data.set(name, content.json);\r\n                    callback(content.json);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 异步加载Json数据表\r\n     * @param name 资源名\r\n     */\r\n    static loadAsync(name: string) {\r\n        return new Promise((resolve, reject) => {\r\n            if (data.has(name)) {\r\n                resolve(data.get(name))\r\n            }\r\n            else {\r\n                var url = path + name;\r\n                oops.res.load(url, JsonAsset, (err: Error | null, content: JsonAsset) => {\r\n                    if (err) {\r\n                        console.warn(err.message);\r\n                        resolve(null);\r\n                    }\r\n                    else {\r\n                        data.set(name, content.json);\r\n                        resolve(content.json);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 通过指定资源名释放资源\r\n     * @param name 资源名\r\n     */\r\n    static release(name: string) {\r\n        var url = path + name;\r\n        data.delete(name);\r\n        oops.res.release(url);\r\n    }\r\n}"]}