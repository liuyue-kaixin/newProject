{"version":3,"sources":["file:///Volumes/%E5%9B%BA%E6%80%81/ccProject/assets/script/battle/collision/Shape.ts"],"names":["cShape","cBox","cSphere","cPolygon","Vec2","Vec3","Intersection2D","obbIntersect","sphereAABBDistance","sphereOBBDistance","ShapeType","constructor","center","type","radius","height","Box","point2Ds","size","x","y","z","scale","aabb","updateAABB","world","isIdentity","sx","sy","sz","cx","cy","cz","uX","m00","uY","m01","uZ","m02","vX","m03","vY","m04","vZ","m05","wX","m06","wY","m07","wZ","m08","cX","cY","cZ","absU","Math","abs","absV","absW","points","Sphere","Polygon","minX","minY","maxX","maxY","length","i","center2","ShapeSupport","a","b","getCenter","getHalfSize","getRotMat3","subtract","getRaidus","getRotation","ca","cb","lengthSqr","radii","polygonPolygon","getPoints","polygonCircle"],"mappings":"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","sourcesContent":["import { Mat3, Vec2, Vec3 } from \"cc\";\nimport Intersection2D, { obbIntersect, sphereAABBDistance, sphereOBBDistance } from \"./AILib\";\nimport { cBody } from \"./Body\";\n\n\n\nexport enum ShapeType {\n    Box = 1,\n    Sphere = 2,\n    Polygon = 4, //AI TODO\n};\n\nexport abstract class cShape {\n\n    radius = 0;\n    height = 0;\n    type = ShapeType.Box;\n    point2Ds: Array<Vec2> = [];\n    size = { x: 0, y: 0, z: 0 };\n    scale = { x: 1, y: 1, z: 1 };\n    center = { x: 0, y: 0, z: 0 };\n    aabb: Array<number> = [0, 0, 0, 0, 0, 0];\n\n    constructor(center: Vec3, type: ShapeType) {\n        this.type = type;\n        // this.isDirty = true;\n        this.center.x = center.x;\n        this.center.y = center.y;\n        this.center.z = center.z;\n    }\n\n\n    updateAABB(scale:Vec3 , world: Mat3, isIdentity: boolean = true) {\n\n        const size = this.size;\n        const center = this.center;\n        const sx = scale.x,sy = scale.y,sz = scale.z;\n        const cx = center.x, cy = center.y, cz = center.z;\n        let x = size.x*0.5, y = size.y*0.5, z = size.z*0.5;\n      \n        const aabb = this.aabb;\n        if(!isIdentity){\n\n            const uX = world.m00*sx, uY = world.m01*sx, uZ = world.m02*sx;\n            const vX = world.m03*sy, vY = world.m04*sy, vZ = world.m05*sy;\n            const wX = world.m06*sz, wY = world.m07*sz, wZ = world.m08*sz;\n    \n            // 计算新的中心点\n            const cX = uX * cx + vX * cy + wX * cz;\n            const cY = uY * cx + vY * cy + wY * cz;\n            const cZ = uZ * cx + vZ * cy + wZ * cz;\n      \n            // 计算新的包围盒宽度、高度和深度\n            const absU = Math.abs(uX) * x + Math.abs(vX) * y + Math.abs(wX) * z;\n            const absV = Math.abs(uY) * x + Math.abs(vY) * y + Math.abs(wY) * z;\n            const absW = Math.abs(uZ) * x + Math.abs(vZ) * y + Math.abs(wZ) * z;\n    \n            // 计算新的最小和最大顶点\n            aabb[0] = cX - absU, aabb[1] = cY - absV, aabb[2] = cZ - absW;\n            aabb[3] = cX + absU, aabb[4] = cY + absV, aabb[5] = cZ + absW;\n            \n        }else{\n            \n            x = Math.abs(x*sx);\n            y = Math.abs(y*sy);\n            z = Math.abs(z*sz);\n\n            aabb[0] = cx*sx - x;\n            aabb[1] = cy*sy - y;\n            aabb[2] = cz*sz - z;\n\n            aabb[3] = cx*sx + x;\n            aabb[4] = cy*sy + y;\n            aabb[5] = cz*sz + z;\n\n        }\n\n        return aabb;\n\n    }\n}\n\nexport class cBox extends cShape {\n\n    constructor(center: Vec3, size: Vec3) {\n        super(center, ShapeType.Box);\n\n        this.size.x = size.x;\n        this.size.y = size.y;\n        this.size.z = size.z;\n\n        //2d 多边形, 点队列\n        let points = this.point2Ds;\n        points[0] = new Vec2(-size.x/2,size.y/2);\n        points[1] = new Vec2(size.x/2,size.y/2);\n        points[2] = new Vec2(size.x/2,-size.y/2);\n        points[3] = new Vec2(-size.x/2,-size.y/2);\n    }\n}\n\nexport class cSphere extends cShape {\n    constructor(center: Vec3, radius: number) {\n        super(center, ShapeType.Sphere);\n        this.radius = radius;\n\n        this.size.x = radius * 2;\n        this.size.y = radius * 2;\n        this.size.z = radius * 2;\n    }\n}\n\n\n//默认y轴竖向\nexport class cPolygon extends cShape {\n    constructor(center: Vec3, points:Array<Vec2>) {\n        super(center, ShapeType.Polygon);\n\n        //2d 多边形, 点队列\n        this.point2Ds = points;\n        let minX  = points[0].x; \n        let minY  = points[0].y; \n        let maxX = minX,maxY = minY;\n\n        let length = points.length;\n        for(let i = 1;i < length;i++){\n            let x = points[i].x;\n            let y = points[i].y;\n\n            if(minX >= x) minX = x;\n            else if(maxX<=x) maxX = x;\n\n            if(minY >= y) minY = y;\n            else if(maxY<=y) maxY = y;\n        }\n\n        this.size.x = maxX - minX;\n        this.size.y = maxY - minY;\n        this.size.z = 0;\n    }\n}\n\n\n\nconst center = new Vec3();\nconst center2 = new Vec2();\n\nexport const ShapeSupport: Array<(a: cBody, b: cBody) => boolean> = [];\n\nShapeSupport[ShapeType.Box | ShapeType.Box] = function (a: cBody, b: cBody) {\n\n    //a,b 没有旋转,已进行AABB处理 , 直接返回 true\n    if (a.isIdentity && b.isIdentity) return true;\n\n    return obbIntersect(a.getCenter(), a.getHalfSize(), a.getRotMat3(), b.getCenter(), b.getHalfSize(), b.getRotMat3());\n}\n\nShapeSupport[ShapeType.Box | ShapeType.Sphere] = function (a: cBody, b: cBody) {\n\n    //a没有旋转当AABB处理 \n    if (a.isIdentity) {\n        // 转换到 aabb 坐标系下\n        Vec3.subtract(center, b.getCenter(), a.getCenter());\n        return sphereAABBDistance(center, b.getRaidus(), a.getHalfSize());\n    }\n\n    return sphereOBBDistance(b.getCenter(), b.getRaidus(), a.getCenter(), a.getRotation(), a.getHalfSize());\n}\n\n\nShapeSupport[ShapeType.Sphere | ShapeType.Sphere] = function (a: cBody, b: cBody) {\n\n    let ca = a.getCenter();\n    let cb = b.getCenter();\n    Vec3.subtract(center, ca, cb);\n    let lengthSqr = center.lengthSqr();\n    let radii = a.getRaidus() + b.getRaidus();\n\n    return lengthSqr <= radii * radii;\n\n}\n\nShapeSupport[ShapeType.Box | ShapeType.Polygon] = function (a: cBody, b: cBody) {\n    //AI TODO\n    return Intersection2D.polygonPolygon(a.getPoints(),b.getPoints());\n\n}\n\nShapeSupport[ShapeType.Sphere | ShapeType.Polygon] = function (a: cBody, b: cBody) {\n    //AI TODO\n    let ca = a.getCenter();\n    let radius = a.getRaidus();\n    center2.x = ca.x, center2.y = ca.y;\n    return Intersection2D.polygonCircle(b.getPoints(),center2,radius);\n}\n\n\nShapeSupport[ShapeType.Polygon | ShapeType.Polygon] = function (a: cBody, b: cBody) {\n    //AI TODO\n    return Intersection2D.polygonPolygon(a.getPoints(),b.getPoints());\n}"]}