{"version":3,"sources":["file:///Volumes/%E5%9B%BA%E6%80%81/ccProject/assets/bundle/battle/demos/bulletHell/bullet.ts"],"names":["_decorator","instantiate","Quat","Vec3","cObject","Trigger","ccclass","property","tempPos","tempRot","Bullet","lifeTime","get","prefab","bullet","pools","pop","node","getComponent","put","push","remove","update","dt","pos","getPosition","velocity","x","y","z","setPosition","onTrigger","b","trigger","exit"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,W,OAAAA,W;AAAqBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;;AAEvCC,MAAAA,O,iBAAAA,O;AAASC,MAAAA,O,iBAAAA,O;;;;;;;;;OACZ;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U;AAExBQ,MAAAA,O,GAAU,IAAIL,IAAJ,E;AACVM,MAAAA,O,GAAU,IAAIP,IAAJ,E;;wBAGHQ,M,WADZJ,OAAO,CAAC,QAAD,C,2BAAR,MACaI,MADb;AAAA;AAAA,8BACoC;AAAA;AAAA;AAoBhC;AApBgC,eAqBhCC,QArBgC,GAqBb,CArBa;AAAA;;AAItB,eAAHC,GAAG,CAACC,MAAD,EAAiB;AACvB,cAAIC,MAAM,GAAG,KAAKC,KAAL,CAAWC,GAAX,EAAb;;AACA,cAAI,CAACF,MAAL,EAAa;AACT,gBAAIG,IAAI,GAAGhB,WAAW,CAACY,MAAD,CAAtB;AACAC,YAAAA,MAAM,GAAGG,IAAI,CAACC,YAAL,CAAkBR,MAAlB,CAAT;AACH;;AACD,iBAAOI,MAAP;AACH;;AAES,eAAHK,GAAG,CAACL,MAAD,EAAiB;AACvB;AACA,eAAKC,KAAL,CAAWK,IAAX,CAAgBN,MAAhB,EAFuB,CAGvB;;AACAA,UAAAA,MAAM,CAACO,MAAP,CAAc,KAAd;AACH;;AAID;AAEAC,QAAAA,MAAM,CAACC,EAAD,EAAa;AAEf,eAAKZ,QAAL,IAAiBY,EAAjB;;AACA,cAAI,KAAKZ,QAAL,GAAgB,CAApB,EAAuB;AACnB;AACAD,YAAAA,MAAM,CAACS,GAAP,CAAW,IAAX;AACA;AACH,WAPc,CASf;;;AACA,cAAIK,GAAG,GAAG,KAAKC,WAAL,EAAV;AACA,cAAIC,QAAQ,GAAG,KAAKA,QAApB;AAEAlB,UAAAA,OAAO,CAACmB,CAAR,GAAYH,GAAG,CAACG,CAAJ,GAAQD,QAAQ,CAACC,CAAT,GAAaJ,EAAjC;AACAf,UAAAA,OAAO,CAACoB,CAAR,GAAYJ,GAAG,CAACI,CAAJ,GAAQF,QAAQ,CAACE,CAAT,GAAaL,EAAjC;AACAf,UAAAA,OAAO,CAACqB,CAAR,GAAYL,GAAG,CAACK,CAAJ,GAAQH,QAAQ,CAACG,CAAT,GAAaN,EAAjC;AAEA,eAAKO,WAAL,CAAiBtB,OAAjB;AAEH;;AAGDuB,QAAAA,SAAS,CAACC,CAAD,EAAUC,OAAV,EAA4B;AACjC,cAAGA,OAAO,IAAI;AAAA;AAAA,kCAAQC,IAAtB,EAA6B,OADI,CAEhC;;AACDxB,UAAAA,MAAM,CAACS,GAAP,CAAW,IAAX,EAHiC,CAKjC;AACA;AACH;;AArD+B,O,UAGzBJ,K,GAAuB,E","sourcesContent":["import { _decorator, instantiate, Prefab, Quat, Vec3 } from 'cc';\nimport { cBody } from '../../collision/Body';\nimport { cObject, Trigger } from '../../collision/Object';\nconst { ccclass, property } = _decorator;\n\nconst tempPos = new Vec3();\nconst tempRot = new Quat();\n\n@ccclass('Bullet')\nexport class Bullet extends cObject {\n\n    //缓存池管理\n    static pools: Array<Bullet> = [];\n    static get(prefab: Prefab) {\n        let bullet = this.pools.pop();\n        if (!bullet) {\n            let node = instantiate(prefab);\n            bullet = node.getComponent(Bullet);\n        }\n        return bullet;\n    }\n\n    static put(bullet: Bullet) {\n        //压入缓存池管理节点\n        this.pools.push(bullet);\n        //移除node不回收body\n        bullet.remove(false);\n    }\n\n    //生命周期，回收时间\n    lifeTime: number = 0;\n    //attack: number = 0;\n\n    update(dt: number) {\n\n        this.lifeTime -= dt;\n        if (this.lifeTime < 0) {\n            //生命周期回收\n            Bullet.put(this);\n            return;\n        }\n\n        //计算新位置\n        let pos = this.getPosition();\n        let velocity = this.velocity;\n\n        tempPos.x = pos.x + velocity.x * dt;\n        tempPos.y = pos.y + velocity.y * dt;\n        tempPos.z = pos.z + velocity.z * dt;\n\n        this.setPosition(tempPos);\n\n    }\n\n\n    onTrigger(b: cBody,trigger: Trigger) {\n        if(trigger == Trigger.exit ) return;\n         //击中回收子弹\n        Bullet.put(this);\n\n        //播放爆炸特效\n        //.........\n    }\n}\n\n"]}