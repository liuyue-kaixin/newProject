{"version":3,"sources":["file:///Volumes/SSD/ccProject/extensions/oops-plugin-framework/assets/core/gui/GUI.ts"],"names":["Camera","Component","ResolutionPolicy","UITransform","_decorator","math","screen","view","oops","ccclass","menu","GUI","transform","camera","portrait","portraitDrz","landscapeDrz","onLoad","init","getComponent","getComponentInChildren","getDesignResolutionSize","width","height","Size","resize","dr","s","windowSize","rw","rh","finalW","finalH","setDesignResolutionSize","UNKNOWN","log","logView"],"mappings":"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","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2021-07-03 16:13:17\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2023-01-19 14:52:40\r\n */\r\nimport { Camera, Component, ResolutionPolicy, UITransform, _decorator, math, screen, view } from \"cc\";\r\nimport { oops } from \"../Oops\";\r\n\r\nconst { ccclass, menu } = _decorator;\r\n\r\n/** 游戏界面屏幕自适应管理 */\r\n@ccclass('GUI')\r\nexport class GUI extends Component {\r\n    /** 界面层矩形信息组件 */\r\n    transform!: UITransform;\r\n    /** 游戏二维摄像机 */\r\n    camera!: Camera;\r\n    /** 是否为竖屏显示 */\r\n    portrait!: boolean;\r\n\r\n    /** 竖屏设计尺寸 */\r\n    private portraitDrz: math.Size = null!;\r\n    /** 横屏设计尺寸 */\r\n    private landscapeDrz: math.Size = null!;\r\n\r\n    onLoad() {\r\n        this.init();\r\n    }\r\n\r\n    /** 初始化引擎 */\r\n    protected init() {\r\n        this.transform = this.getComponent(UITransform)!;\r\n        this.camera = this.getComponentInChildren(Camera)!;\r\n\r\n        if (view.getDesignResolutionSize().width > view.getDesignResolutionSize().height) {\r\n            this.landscapeDrz = view.getDesignResolutionSize();\r\n            this.portraitDrz = new math.Size(this.landscapeDrz.height, this.landscapeDrz.width);\r\n        }\r\n        else {\r\n            this.portraitDrz = view.getDesignResolutionSize();\r\n            this.landscapeDrz = new math.Size(this.portraitDrz.height, this.portraitDrz.width);\r\n        }\r\n\r\n        this.resize();\r\n    }\r\n\r\n    /** 游戏画布尺寸变化 */\r\n    resize() {\r\n        let dr;\r\n        if (view.getDesignResolutionSize().width > view.getDesignResolutionSize().height) {\r\n            dr = this.landscapeDrz;\r\n        }\r\n        else {\r\n            dr = this.portraitDrz\r\n        }\r\n\r\n        var s = screen.windowSize;\r\n        var rw = s.width;\r\n        var rh = s.height;\r\n        var finalW = rw;\r\n        var finalH = rh;\r\n\r\n        if ((rw / rh) > (dr.width / dr.height)) {\r\n            // 如果更长，则用定高\r\n            finalH = dr.height;\r\n            finalW = finalH * rw / rh;\r\n            this.portrait = false;\r\n        }\r\n        else {\r\n            // 如果更短，则用定宽\r\n            finalW = dr.width;\r\n            finalH = finalW * rh / rw;\r\n            this.portrait = true;\r\n        }\r\n\r\n        // 手工修改canvas和设计分辨率，这样反复调用也能生效。\r\n        view.setDesignResolutionSize(finalW, finalH, ResolutionPolicy.UNKNOWN);\r\n        this.transform!.width = finalW;\r\n        this.transform!.height = finalH;\r\n\r\n        oops.log.logView(dr, \"设计尺寸\");\r\n        oops.log.logView(s, \"屏幕尺寸\");\r\n    }\r\n}"]}