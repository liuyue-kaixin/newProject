{"version":3,"sources":["file:///Volumes/%E5%9B%BA%E6%80%81/ccProject/extensions/oops-plugin-framework/assets/core/common/audio/AudioEffect.ts"],"names":["AudioClip","AudioSource","error","_decorator","oops","ccclass","menu","AudioEffect","effects","Map","load","url","callback","res","err","data","set","playOneShot","volume","release","key","clear"],"mappings":";;;;;;;;;;;;;;;;AAMSA,MAAAA,S,OAAAA,S;AAAWC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,U,OAAAA,U;;AAC/BC,MAAAA,I,iBAAAA,I;;;;;;AAPT;AACA;AACA;AACA;AACA;AACA;;;;;OAGM;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAoBH,U;AAE1B;AACA;AACA;;AAEA;;6BAEaI,W,WADZF,OAAO,CAAC,aAAD,C,gBAAR,MACaE,WADb,SACiCN,WADjC,CAC6C;AAAA;AAAA;AAAA,eACjCO,OADiC,GACC,IAAIC,GAAJ,EADD;AAAA;;AAGzC;AACJ;AACA;AACA;AACA;AACIC,QAAAA,IAAI,CAACC,GAAD,EAAcC,QAAd,EAAmC;AACnC;AAAA;AAAA,4BAAKC,GAAL,CAASH,IAAT,CAAcC,GAAd,EAAmBX,SAAnB,EAA8B,CAACc,GAAD,EAAoBC,IAApB,KAAwC;AAClE,gBAAID,GAAJ,EAAS;AACLZ,cAAAA,KAAK,CAACY,GAAD,CAAL;AACH;;AAED,iBAAKN,OAAL,CAAaQ,GAAb,CAAiBL,GAAjB,EAAsBI,IAAtB;AACA,iBAAKE,WAAL,CAAiBF,IAAjB,EAAuB,KAAKG,MAA5B;AACAN,YAAAA,QAAQ,IAAIA,QAAQ,EAApB;AACH,WARD;AASH;AAED;;;AACAO,QAAAA,OAAO,GAAG;AACN,eAAK,IAAIC,GAAT,IAAgB,KAAKZ,OAArB,EAA8B;AAC1B;AAAA;AAAA,8BAAKK,GAAL,CAASM,OAAT,CAAiBC,GAAjB;AACH;;AACD,eAAKZ,OAAL,CAAaa,KAAb;AACH;;AA1BwC,O","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2022-09-01 18:00:28\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2022-09-02 10:22:36\r\n */\r\nimport { AudioClip, AudioSource, error, _decorator } from 'cc';\r\nimport { oops } from '../../Oops';\r\nconst { ccclass, menu } = _decorator;\r\n\r\n/**\r\n * 注：用playOneShot播放的音乐效果，在播放期间暂时没办法即时关闭音乐\r\n */\r\n\r\n/** 游戏音效 */\r\n@ccclass('AudioEffect')\r\nexport class AudioEffect extends AudioSource {\r\n    private effects: Map<string, AudioClip> = new Map<string, AudioClip>();\r\n\r\n    /**\r\n     * 加载音效并播放\r\n     * @param url           音效资源地址\r\n     * @param callback      资源加载完成并开始播放回调\r\n     */\r\n    load(url: string, callback?: Function) {\r\n        oops.res.load(url, AudioClip, (err: Error | null, data: AudioClip) => {\r\n            if (err) {\r\n                error(err);\r\n            }\r\n\r\n            this.effects.set(url, data);\r\n            this.playOneShot(data, this.volume);\r\n            callback && callback();\r\n        });\r\n    }\r\n\r\n    /** 释放所有已使用过的音效资源 */\r\n    release() {\r\n        for (let key in this.effects) {\r\n            oops.res.release(key);\r\n        }\r\n        this.effects.clear();\r\n    }\r\n}\r\n"]}