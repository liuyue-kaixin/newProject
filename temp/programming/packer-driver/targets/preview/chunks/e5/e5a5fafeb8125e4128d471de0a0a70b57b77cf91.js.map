{"version":3,"sources":["file:///Volumes/SSD/ccProject/assets/script/game/initialize/view/LoadingViewComp.ts"],"names":["_decorator","oops","ecs","CCVMParentComp","GameEvent","UIID","smc","ccclass","property","LoadingViewComp","register","data","finished","total","progress","prompt","reset","setTimeout","gui","remove","Loading","open","GameMain","start","enter","addEvent","loadRes","on","LoginSuccess","onHandler","event","args","ent","loadCustom","loadGameRes","Promise","resolve","reject","res","loadDir","onProgressCallback","bind","onCompleteCallback","item","toFixed","account","connect"],"mappings":"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","sourcesContent":["/*\n * @Author: dgflash\n * @Date: 2021-07-03 16:13:17\n * @LastEditors: dgflash\n * @LastEditTime: 2022-08-29 13:37:08\n */\nimport { _decorator } from \"cc\";\nimport { oops } from \"../../../../../extensions/oops-plugin-framework/assets/core/Oops\";\nimport { JsonUtil } from \"../../../../../extensions/oops-plugin-framework/assets/core/utils/JsonUtil\";\nimport { ecs } from \"../../../../../extensions/oops-plugin-framework/assets/libs/ecs/ECS\";\nimport { CCVMParentComp } from \"../../../../../extensions/oops-plugin-framework/assets/module/common/CCVMParentComp\";\nimport { GameEvent } from \"../../common/config/GameEvent\";\nimport { UIID } from \"../../common/config/GameUIConfig\";\nimport { smc } from \"../../common/ecs/SingletonModuleComp\";\n\nconst { ccclass, property } = _decorator;\n\n/** 游戏资源加载 */\n@ccclass('LoadingViewComp')\n@ecs.register('LoadingView', false)\nexport class LoadingViewComp extends CCVMParentComp {\n    /** VM 组件绑定数据 */\n    data: any = {\n        /** 加载资源当前进度 */\n        finished: 0,\n        /** 加载资源最大进度 */\n        total: 0,\n        /** 加载资源进度比例值 */\n        progress: \"0\",\n        /** 加载流程中提示文本 */\n        prompt: \"\"\n    };\n\n    private progress: number = 0;\n\n    reset(): void {\n        setTimeout(() => {\n            // 关闭加载界面\n            oops.gui.remove(UIID.Loading);\n\n            // 打开游戏主界面（自定义逻辑）\n            oops.gui.open(UIID.GameMain);\n        }, 500);\n    }\n\n    start() {\n        // if (!sys.isNative) {\n        this.enter();\n        // }\n    }\n\n    enter() {\n        this.addEvent();\n        this.loadRes();\n    }\n\n    private addEvent() {\n        this.on(GameEvent.LoginSuccess, this.onHandler, this);\n    }\n\n    private onHandler(event: string, args: any) {\n        switch (event) {\n            case GameEvent.LoginSuccess:\n                // 加载流程结束，移除加载提示界面\n                this.ent.remove(LoadingViewComp);\n                break;\n        }\n    }\n\n    /** 加载资源 */\n    private async loadRes() {\n        this.data.progress = 0;\n        await this.loadCustom();\n        this.loadGameRes();\n    }\n\n    /** 加载游戏本地JSON数据（自定义内容） */\n    private loadCustom() {\n        // 加载游戏本地JSON数据的多语言提示文本\n        this.data.prompt = \"加载中\" //oops.language.getLangByID(\"loading_load_json\");\n\n        return new Promise(async (resolve, reject) => {\n            resolve(null);\n        });\n    }\n\n    /** 加载初始游戏内容资源 */\n    private loadGameRes() {\n        // 加载初始游戏内容资源的多语言提示文本\n        // this.data.prompt = oops.language.getLangByID(\"loading_load_game\");\n\n        oops.res.loadDir(\"gui\", this.onProgressCallback.bind(this), this.onCompleteCallback.bind(this));\n    }\n\n    /** 加载进度事件 */\n    private onProgressCallback(finished: number, total: number, item: any) {\n        this.data.finished = finished;\n        this.data.total = total;\n\n        var progress = finished / total;\n        if (progress > this.progress) {\n            this.progress = progress;\n            this.data.progress = (progress * 100).toFixed(2);\n        }\n    }\n\n    /** 加载完成事件 */\n    private onCompleteCallback() {\n        // 获取用户信息的多语言提示文本\n        // this.data.prompt = oops.language.getLangByID(\"loading_load_player\");\n\n        // 初始化帐号模块\n        smc.account.connect();\n\n        this.reset()\n    }\n}"]}