{"version":3,"sources":["file:///Volumes/%E5%9B%BA%E6%80%81/ccProject/extensions/oops-plugin-framework/assets/libs/model-view/VMEvent.ts"],"names":["CCString","Enum","EventHandler","_decorator","VMBase","ccclass","property","executeInEditMode","menu","help","FILTER_MODE","VMEvent","tooltip","visible","templateMode","type","filterMode","none","onValueInit","onValueChanged","newVar","oldVar","pathArr","res","conditionCheck","compareValue","Array","isArray","changeEvents","forEach","v","emit","triggerOnce","enabled","a","b","cod"],"mappings":"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","sourcesContent":["import { CCString, Enum, EventHandler, _decorator } from 'cc';\r\nimport { VMBase } from './VMBase';\r\n\r\n// +普通 label 更新数据的情况,label.string = xxx;\r\n// +frameIndex 插件，通过number 数值设置 BhvFrameIndex 来切换当前贴图\r\n// +spriteFrame 直接替换贴图的情况 , \r\n//  读取本地路径 data.spriteFrame = $res:/pic/com1\r\n//  读取网页路径 data.spriteFrame = $url:http:xxxxxxxxxx.png\r\n// +特殊条件控制 \r\n\r\n// 比较条件:,如果传入值 > /< />= /<= /== 某值时，执行的action类型\r\n\r\nconst { ccclass, property, executeInEditMode, menu, help } = _decorator;\r\n\r\nenum FILTER_MODE {\r\n    \"none\",\r\n    \"==\", // 正常计算，比较 等于\r\n    \"!=\", // 正常计算，比较 不等于\r\n    \">\",  // 正常计算，比较>\r\n    \">=\", // 正常计算，比较>=\r\n    \"<\",  // 正常计算，比较<\r\n    \"<=\", // 正常计算，比较>=\r\n}\r\n\r\n/**\r\n *  [VM-Event]\r\n * 提供  ViewModel 的相关基础功能,\r\n * 如果值发生变化将会调用对应的函数方法\r\n */\r\n@ccclass\r\n@executeInEditMode\r\n@menu('ModelViewer/VM-EventCall(调用函数)')\r\n@help('https://gitee.com/dgflash/oops-framework/blob/master/doc/mvvm/VMEvent.md')\r\nexport default class VMEvent extends VMBase {\r\n    @property({\r\n        tooltip: '使用模板模式，可以使用多路径监听'\r\n    })\r\n    public templateMode: boolean = false;\r\n\r\n    @property({\r\n        tooltip: '监听获取值的路径',\r\n        visible: function () {\r\n            // @ts-ignore\r\n            return this.templateMode === false;\r\n        }\r\n    })\r\n    watchPath: string = \"\";\r\n\r\n    @property({\r\n        tooltip: '触发一次后会自动关闭该事件'\r\n    })\r\n    triggerOnce: boolean = false;\r\n\r\n    @property({\r\n        tooltip: '监听获取值的多条路径,这些值的改变都会通过这个函数回调,请使用 pathArr 区分获取的值 ',\r\n        type: [CCString],\r\n        visible: function () {\r\n            // @ts-ignore\r\n            return this.templateMode === true;\r\n        }\r\n    })\r\n    protected watchPathArr: string[] = [];\r\n\r\n    @property({\r\n        tooltip: '过滤模式，会根据条件过滤掉时间的触发',\r\n        type: Enum(FILTER_MODE)\r\n    })\r\n    public filterMode: FILTER_MODE = FILTER_MODE.none;\r\n\r\n    @property({\r\n        visible: function () {\r\n            // @ts-ignore\r\n            return this.filterMode !== FILTER_MODE.none\r\n        }\r\n    })\r\n    public compareValue: string = '';\r\n\r\n    @property([EventHandler])\r\n    changeEvents: EventHandler[] = [];\r\n\r\n    onValueInit() {\r\n\r\n    }\r\n\r\n    onValueChanged(newVar: any, oldVar: any, pathArr: any[]) {\r\n        let res = this.conditionCheck(newVar, this.compareValue);\r\n        if (!res) return;\r\n\r\n        if (Array.isArray(this.changeEvents)) {\r\n            this.changeEvents.forEach(v => {\r\n                v.emit([newVar, oldVar, pathArr]);\r\n            })\r\n        }\r\n\r\n        // 激活一次后，自动关闭组件\r\n        if (this.triggerOnce === true) {\r\n            this.enabled = false;\r\n        }\r\n    }\r\n\r\n    /** 条件检查 */\r\n    private conditionCheck(a: any, b: any): boolean {\r\n        let cod = FILTER_MODE;\r\n\r\n        switch (this.filterMode) {\r\n            case cod.none:\r\n                return true;\r\n            case cod[\"==\"]:\r\n                if (a == b) return true;\r\n                break;\r\n            case cod[\"!=\"]:\r\n                if (a != b) return true;\r\n                break;\r\n            case cod[\"<\"]:\r\n                if (a < b) return true;\r\n                break;\r\n            case cod[\">\"]:\r\n                if (a > b) return true;\r\n                break;\r\n            case cod[\">=\"]:\r\n                if (a >= b) return true;\r\n                break;\r\n            case cod[\"<\"]:\r\n                if (a < b) return true;\r\n                break;\r\n            case cod[\"<=\"]:\r\n                if (a <= b) return true;\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n\r\n        return false;\r\n    }\r\n}"]}