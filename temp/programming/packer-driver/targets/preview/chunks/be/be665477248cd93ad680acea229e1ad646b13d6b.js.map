{"version":3,"sources":["file:///Volumes/%E5%9B%BA%E6%80%81/ccProject/extensions/oops-plugin-framework/assets/libs/camera/FreeFlightCamera.ts"],"names":["CCFloat","Component","game","Input","input","KeyCode","math","_decorator","ccclass","property","menu","Vec2","Vec3","Quat","v2_1","v2_2","v3_1","qt_1","KEYCODE","W","charCodeAt","S","A","D","Q","E","SHIFT","SHIFT_LEFT","FreeFlightCamera","type","tooltip","slide","range","_euler","_velocity","_position","_speedScale","onLoad","on","EventType","MOUSE_WHEEL","onMouseWheel","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","copy","node","eulerAngles","position","onDestroy","off","update","dt","transformQuat","rotation","scaleAndAdd","moveSpeed","lerp","damp","setPosition","fromEuler","x","y","z","slerp","setRotation","event","delta","getScrollY","UNIT_Z","v","keyCode","moveSpeedShiftScale","e","canvas","requestPointerLock","getStartLocation","width","getDelta","rotateSpeed","getLocation","subtract","document","exitPointerLock"],"mappings":"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","sourcesContent":["/**\r\n * 自由飞行摄像机\r\n * 使用方式：\r\n * 1、组件绑定到任意一设想机上\r\n * 2、通过W(上）、S(下)、A(左）、D(右）、Q(Y轴向下）、E(Y轴向上）来操作摄像机移动\r\n * 3、按住SHIFT键会加速飞行\r\n * 4、鼠标左或右键按下滑动控制摄像机视角原地旋转\r\n * 5、鼠标滚轮键滑动摄像机拉近或拉远\r\n * 6、只支持PC上使用\r\n */\r\n\r\nimport { CCFloat, Component, EventKeyboard, EventMouse, EventTouch, game, Input, input, KeyCode, math, _decorator } from 'cc';\r\nconst { ccclass, property, menu } = _decorator;\r\n\r\nconst { Vec2, Vec3, Quat } = math;\r\nconst v2_1 = new Vec2();\r\nconst v2_2 = new Vec2();\r\nconst v3_1 = new Vec3();\r\nconst qt_1 = new Quat();\r\n\r\nconst KEYCODE = {\r\n    W: 'W'.charCodeAt(0),\r\n    S: 'S'.charCodeAt(0),\r\n    A: 'A'.charCodeAt(0),\r\n    D: 'D'.charCodeAt(0),\r\n    Q: 'Q'.charCodeAt(0),\r\n    E: 'E'.charCodeAt(0),\r\n    SHIFT: KeyCode.SHIFT_LEFT\r\n};\r\n\r\n@ccclass(\"FreeFlightCamera\")\r\n@menu('oops/camera/FreeFlightCamera')\r\nexport class FreeFlightCamera extends Component {\r\n    @property({\r\n        type: CCFloat,\r\n        tooltip: \"移动速度\"\r\n    })\r\n    public moveSpeed: number = 1;\r\n\r\n    @property({\r\n        type: CCFloat,\r\n        tooltip: \"按Shift键后的速度\"\r\n    })\r\n    public moveSpeedShiftScale: number = 5;\r\n\r\n    @property({\r\n        type: CCFloat,\r\n        slide: true,\r\n        range: [0.05, 0.5, 0.01],\r\n        tooltip: \"移动后惯性效果\"\r\n    })\r\n    public damp: number = 0.2;\r\n\r\n    @property({\r\n        type: CCFloat,\r\n        tooltip: \"旋转速度\"\r\n    })\r\n    public rotateSpeed: number = 1;\r\n\r\n    public _euler = new Vec3();\r\n    public _velocity = new Vec3();\r\n    public _position = new Vec3();\r\n    public _speedScale = 1;\r\n\r\n    public onLoad() {\r\n        input.on(Input.EventType.MOUSE_WHEEL, this.onMouseWheel, this);\r\n        input.on(Input.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        input.on(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n        input.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\r\n        input.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        input.on(Input.EventType.TOUCH_END, this.onTouchEnd, this);\r\n\r\n        Vec3.copy(this._euler, this.node.eulerAngles);\r\n        Vec3.copy(this._position, this.node.position);\r\n    }\r\n\r\n    public onDestroy() {\r\n        input.off(Input.EventType.MOUSE_WHEEL, this.onMouseWheel, this);\r\n        input.off(Input.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        input.off(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n        input.off(Input.EventType.TOUCH_START, this.onTouchStart, this);\r\n        input.off(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        input.off(Input.EventType.TOUCH_END, this.onTouchEnd, this);\r\n    }\r\n\r\n    public update(dt: number) {\r\n        // position\r\n        Vec3.transformQuat(v3_1, this._velocity, this.node.rotation);\r\n        Vec3.scaleAndAdd(this._position, this._position, v3_1, this.moveSpeed * this._speedScale);\r\n        Vec3.lerp(v3_1, this.node.position, this._position, dt / this.damp);        // 向量线性插值产生位移惯性效果\r\n        this.node.setPosition(v3_1);\r\n\r\n        // rotation\r\n        Quat.fromEuler(qt_1, this._euler.x, this._euler.y, this._euler.z);\r\n        Quat.slerp(qt_1, this.node.rotation, qt_1, dt / this.damp);                 // 四元素线性插值产生旋转惯性效果\r\n        this.node.setRotation(qt_1);\r\n    }\r\n\r\n    public onMouseWheel(event: EventMouse) {\r\n        const delta = -event.getScrollY() * this.moveSpeed * 0.1;                       // 向下滚动时增量为正\r\n        Vec3.transformQuat(v3_1, Vec3.UNIT_Z, this.node.rotation);\r\n        Vec3.scaleAndAdd(this._position, this.node.position, v3_1, delta);\r\n    }\r\n\r\n    public onKeyDown(event: EventKeyboard) {\r\n        const v = this._velocity;\r\n        if (event.keyCode === KEYCODE.SHIFT) { this._speedScale = this.moveSpeedShiftScale; }\r\n        else if (event.keyCode === KEYCODE.W) { if (v.z === 0) { v.z = -1; } }\r\n        else if (event.keyCode === KEYCODE.S) { if (v.z === 0) { v.z = 1; } }\r\n        else if (event.keyCode === KEYCODE.A) { if (v.x === 0) { v.x = -1; } }\r\n        else if (event.keyCode === KEYCODE.D) { if (v.x === 0) { v.x = 1; } }\r\n        else if (event.keyCode === KEYCODE.Q) { if (v.y === 0) { v.y = -1; } }\r\n        else if (event.keyCode === KEYCODE.E) { if (v.y === 0) { v.y = 1; } }\r\n    }\r\n\r\n    public onKeyUp(event: EventKeyboard) {\r\n        const v = this._velocity;\r\n        if (event.keyCode === KEYCODE.SHIFT) { this._speedScale = 1; }\r\n        else if (event.keyCode === KEYCODE.W) { if (v.z < 0) { v.z = 0; } }\r\n        else if (event.keyCode === KEYCODE.S) { if (v.z > 0) { v.z = 0; } }\r\n        else if (event.keyCode === KEYCODE.A) { if (v.x < 0) { v.x = 0; } }\r\n        else if (event.keyCode === KEYCODE.D) { if (v.x > 0) { v.x = 0; } }\r\n        else if (event.keyCode === KEYCODE.Q) { if (v.y < 0) { v.y = 0; } }\r\n        else if (event.keyCode === KEYCODE.E) { if (v.y > 0) { v.y = 0; } }\r\n    }\r\n\r\n    private onTouchStart(e: EventTouch) {\r\n        game.canvas!.requestPointerLock();\r\n    }\r\n\r\n    private onTouchMove(e: EventTouch) {\r\n        e.getStartLocation(v2_1);\r\n        if (v2_1.x > game.canvas!.width * 0.4) {                     // rotation\r\n            e.getDelta(v2_2);\r\n            this._euler.y -= v2_2.x * this.rotateSpeed * 0.1;       // 上下旋转\r\n            this._euler.x += v2_2.y * this.rotateSpeed * 0.1;       // 左右旋转\r\n        }\r\n        else {                                                      // position\r\n            e.getLocation(v2_2);\r\n            Vec2.subtract(v2_2, v2_2, v2_1);\r\n            this._velocity.x = v2_2.x * 0.01;\r\n            this._velocity.z = -v2_2.y * 0.01;\r\n        }\r\n    }\r\n\r\n    private onTouchEnd(e: EventTouch) {\r\n        if (document.exitPointerLock) {\r\n            document.exitPointerLock();\r\n        }\r\n\r\n        e.getStartLocation(v2_1);\r\n        if (v2_1.x < game.canvas!.width * 0.4) {                      // position\r\n            this._velocity.x = 0;\r\n            this._velocity.z = 0;\r\n        }\r\n    }\r\n}"]}