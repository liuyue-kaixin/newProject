{"version":3,"sources":["file:///Volumes/SSD%201/ccProject/extensions/oops-plugin-framework/assets/libs/network/NetProtocolPako.ts"],"names":["NetProtocolPako","unzip","str","charData","split","map","x","charCodeAt","binData","Uint8Array","data","pako","inflate","to","zip","binaryString","gzip","getHeadlen","getHearbeat","getPackageLen","msg","toString","length","checkResponsePackage","respProtocol","handlerResponsePackage","code","isCompress","JSON","parse","handlerRequestPackage","reqProtocol","rspCmd","cmd","callback","getPackageId"],"mappings":";;;8BAyBaA,e;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAzBb;AACA;AACA;AACA;AACA;AACA;;;AAGIC,MAAAA,K,GAAQ,SAARA,KAAQ,CAAUC,GAAV,EAAuB;AAC/B,YAAIC,QAAQ,GAAGD,GAAG,CAACE,KAAJ,CAAU,EAAV,EAAcC,GAAd,CAAkB,UAAUC,CAAV,EAAa;AAC1C,iBAAOA,CAAC,CAACC,UAAF,CAAa,CAAb,CAAP;AACH,SAFc,CAAf;AAGA,YAAIC,OAAO,GAAG,IAAIC,UAAJ,CAAeN,QAAf,CAAd,CAJ+B,CAK/B;;AACA,YAAIO,IAAI,GAAGC,IAAI,CAACC,OAAL,CAAaJ,OAAb,EAAsB;AAAEK,UAAAA,EAAE,EAAE;AAAN,SAAtB,CAAX;AACA,eAAOH,IAAP;AACH,O;;AAEGI,MAAAA,G,GAAM,SAANA,GAAM,CAAUZ,GAAV,EAAuB;AAC7B;AACA,YAAIa,YAAY,GAAGJ,IAAI,CAACK,IAAL,CAAUd,GAAV,EAAe;AAAEW,UAAAA,EAAE,EAAE;AAAN,SAAf,CAAnB;AACA,eAAOE,YAAP;AACH,O;AAED;;;iCACaf,e,GAAN,MAAMA,eAAN,CAAiD;AACpDiB,QAAAA,UAAU,GAAW;AACjB,iBAAO,CAAP;AACH;;AAEDC,QAAAA,WAAW,GAAY;AACnB,iBAAO,EAAP;AACH;;AAEDC,QAAAA,aAAa,CAACC,GAAD,EAAuB;AAChC,iBAAOA,GAAG,CAACC,QAAJ,GAAeC,MAAtB;AACH;;AAEDC,QAAAA,oBAAoB,CAACC,YAAD,EAA2C;AAC3D,iBAAO,IAAP;AACH;;AAEDC,QAAAA,sBAAsB,CAACD,YAAD,EAA2C;AAC7D,cAAIA,YAAY,CAACE,IAAb,IAAqB,CAAzB,EAA4B;AACxB,gBAAIF,YAAY,CAACG,UAAjB,EAA6B;AACzBH,cAAAA,YAAY,CAACd,IAAb,GAAoBT,KAAK,CAACuB,YAAY,CAACd,IAAd,CAAzB;AACH;;AACDc,YAAAA,YAAY,CAACd,IAAb,GAAoBkB,IAAI,CAACC,KAAL,CAAWL,YAAY,CAACd,IAAxB,CAApB;AAEA,mBAAO,IAAP;AACH,WAPD,MAQK;AACD,mBAAO,KAAP;AACH;AACJ;;AAEDoB,QAAAA,qBAAqB,CAACC,WAAD,EAAwC;AACzD,cAAIC,MAAM,GAAGD,WAAW,CAACE,GAAzB;AACAF,UAAAA,WAAW,CAACG,QAAZ,GAAuBF,MAAvB;;AACA,cAAID,WAAW,CAACJ,UAAhB,EAA4B;AACxBI,YAAAA,WAAW,CAACrB,IAAZ,GAAmBI,GAAG,CAACiB,WAAW,CAACrB,IAAb,CAAtB;AACH;;AACD,iBAAOsB,MAAP;AACH;;AAEDG,QAAAA,YAAY,CAACX,YAAD,EAA0C;AAClD,iBAAOA,YAAY,CAACU,QAApB;AACH;;AA1CmD,O","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2022-04-21 13:45:51\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2022-04-21 13:51:33\r\n */\r\nimport { IProtocolHelper, IRequestProtocol, IResponseProtocol, NetData } from \"./NetInterface\";\r\n\r\nvar unzip = function (str: string) {\r\n    let charData = str.split('').map(function (x) {\r\n        return x.charCodeAt(0);\r\n    });\r\n    let binData = new Uint8Array(charData);\r\n    //@ts-ignore\r\n    let data = pako.inflate(binData, { to: 'string' });\r\n    return data;\r\n}\r\n\r\nvar zip = function (str: string) {\r\n    //@ts-ignore\r\n    let binaryString = pako.gzip(str, { to: 'string' });\r\n    return binaryString;\r\n}\r\n\r\n/** Pako.js 数据压缩协议 */\r\nexport class NetProtocolPako implements IProtocolHelper {\r\n    getHeadlen(): number {\r\n        return 0;\r\n    }\r\n\r\n    getHearbeat(): NetData {\r\n        return \"\";\r\n    }\r\n\r\n    getPackageLen(msg: NetData): number {\r\n        return msg.toString().length;\r\n    }\r\n\r\n    checkResponsePackage(respProtocol: IResponseProtocol): boolean {\r\n        return true;\r\n    }\r\n\r\n    handlerResponsePackage(respProtocol: IResponseProtocol): boolean {\r\n        if (respProtocol.code == 1) {\r\n            if (respProtocol.isCompress) {\r\n                respProtocol.data = unzip(respProtocol.data);\r\n            }\r\n            respProtocol.data = JSON.parse(respProtocol.data);\r\n\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    handlerRequestPackage(reqProtocol: IRequestProtocol): string {\r\n        var rspCmd = reqProtocol.cmd;\r\n        reqProtocol.callback = rspCmd;\r\n        if (reqProtocol.isCompress) {\r\n            reqProtocol.data = zip(reqProtocol.data);\r\n        }\r\n        return rspCmd;\r\n    }\r\n\r\n    getPackageId(respProtocol: IResponseProtocol): string {\r\n        return respProtocol.callback!;\r\n    }\r\n}"]}